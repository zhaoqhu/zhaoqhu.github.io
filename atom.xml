<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="http://localhost:4000/atom.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2025-12-05T23:43:07+08:00</updated><id>http://localhost:4000/atom.xml</id><title type="html">Zhao Q.H.â€™s Notes</title><subtitle>Keep It Simple, Stupid</subtitle><author><name>Zhao Q.H.</name></author><entry><title type="html">Rabbitmqé¢è¯•æ±‡æ€»</title><link href="http://localhost:4000/%E9%9D%A2%E8%AF%95/2025/12/05/rabbitmq-ms/" rel="alternate" type="text/html" title="Rabbitmqé¢è¯•æ±‡æ€»" /><published>2025-12-05T00:00:00+08:00</published><updated>2025-12-05T00:00:00+08:00</updated><id>http://localhost:4000/%E9%9D%A2%E8%AF%95/2025/12/05/rabbitmq-ms</id><content type="html" xml:base="http://localhost:4000/%E9%9D%A2%E8%AF%95/2025/12/05/rabbitmq-ms/">&lt;h2 id=&quot;æ¶ˆæ¯é˜Ÿåˆ—&quot;&gt;æ¶ˆæ¯é˜Ÿåˆ—&lt;/h2&gt;
&lt;p&gt;ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘å¾€äº¤æ¢æœºï¼Œäº¤æ¢æœºä¾æ®è·¯ç”±è§„åˆ™å’Œç»‘å®šå…³ç³»å°†æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šé˜Ÿåˆ—ï¼›é˜Ÿåˆ—æŒä¹…åŒ–å­˜å‚¨æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—è·å–æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆåå‘é€ ACKï¼ŒRabbitMQ ç¡®è®¤ååˆ é™¤æ¶ˆæ¯ â€”â€” å½¢æˆä¸€æ¡å®Œæ•´ã€å¯é ã€å¯æ§çš„æ¶ˆæ¯æµè½¬é“¾è·¯ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;+----------------+      è·¯ç”±       +-------------+      å­˜å‚¨      +-------------+
| ç”Ÿäº§è€…å‘é€æ¶ˆæ¯ | -------------&amp;gt; | äº¤æ¢æœºè·¯ç”±  | -------------&amp;gt; | é˜Ÿåˆ—å­˜å‚¨æ¶ˆæ¯ |
+----------------+               +-------------+               +-------------+
                                       â†‘
                                       ç»‘å®šå…³ç³»ï¼ˆExchange-Queueï¼‰
                                       â†“
+----------------+      è®¢é˜…/ACK      +-------------+
| æ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ— | &amp;lt;------------------ | æ¶ˆæ¯å¤„ç†å®Œæˆ |
+----------------+                   +-------------+

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;ç”Ÿäº§è€…&quot;&gt;ç”Ÿäº§è€…&lt;/h2&gt;

&lt;h3 id=&quot;-å¦‚ä½•ç¡®ä¿å‡ ä¹-100ä¸ä¸¢-5-å±‚é˜²æŠ¤è¯¦è§£&quot;&gt;âœ… å¦‚ä½•ç¡®ä¿â€œå‡ ä¹ 100%â€ä¸ä¸¢ï¼Ÿâ€”â€” 5 å±‚é˜²æŠ¤è¯¦è§£&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;å±‚çº§&lt;/th&gt;
      &lt;th&gt;æœºåˆ¶&lt;/th&gt;
      &lt;th&gt;è§£å†³çš„é—®é¢˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1ï¸âƒ£ å¹‚ç­‰æ§åˆ¶&lt;/td&gt;
      &lt;td&gt;Redis &lt;code class=&quot;highlighter-rouge&quot;&gt;SET NX&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;é˜²æ­¢å¹¶å‘å‹æµ‹å¯¼è‡´é‡å¤å‘é€&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2ï¸âƒ£ æŒä¹…åŒ–&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;delivery_mode=2&lt;/code&gt; + &lt;code class=&quot;highlighter-rouge&quot;&gt;durable=true&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;é˜²æ­¢ Broker é‡å¯ä¸¢æ¶ˆæ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3ï¸âƒ£ Publisher Confirms&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ack&lt;/code&gt;/&lt;code class=&quot;highlighter-rouge&quot;&gt;nack&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;ç¡®è®¤æ¶ˆæ¯è¢« Broker æ¥æ”¶å¹¶æŒä¹…åŒ–&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4ï¸âƒ£ Mandatory + Return&lt;/td&gt;
      &lt;td&gt;è·¯ç”±å¤±è´¥è¿”å›&lt;/td&gt;
      &lt;td&gt;é˜²æ­¢æ¶ˆæ¯å› è·¯ç”±é”™è¯¯è¢«é™é»˜ä¸¢å¼ƒ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5ï¸âƒ£ å¤±è´¥å›æ»š&lt;/td&gt;
      &lt;td&gt;åˆ é™¤ Redis æ ‡è®°&lt;/td&gt;
      &lt;td&gt;å…è®¸é‡è¯•ï¼Œé¿å…æ°¸ä¹…é˜»å¡&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;ç”Ÿäº§ç¯å¢ƒä¸­ç”Ÿäº§è€…çš„æ ‡å‡†ç­”æ¡ˆ&quot;&gt;ç”Ÿäº§ç¯å¢ƒä¸­ç”Ÿäº§è€…çš„æ ‡å‡†ç­”æ¡ˆ&lt;/h3&gt;
&lt;p&gt;æ²¡æœ‰ä¸€ä¸ª basic_publish()èƒ½ä¿è¯æ¶ˆæ¯å…¥é˜Ÿï¼Œä½†â€œæŒä¹…åŒ– + confirms + mandatory + return + å¹‚ç­‰ + é‡è¯•â€çš„ç»„åˆæ‹³ï¼Œå¯ä»¥è®©æ¶ˆæ¯ä¸¢å¤±æ¦‚ç‡ä½äº 0.001%ï¼Œè¾¾åˆ°å·¥ä¸šçº§å¯é æ€§&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
require_once __DIR__ . '/vendor/autoload.php';

use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;
use PhpAmqpLib\Exception\AMQPTimeoutException;

class ReliableRabbitMQProducer
{
    private $connection;
    private $redis; // ç”¨äºå¹‚ç­‰æ§åˆ¶

    public function __construct()
    {
        // 1. å»ºç«‹ RabbitMQ è¿æ¥ï¼ˆè¿›ç¨‹å†…å¤ç”¨ï¼‰
        $this-&amp;gt;connection = new AMQPStreamConnection(
            'rabbitmq', 5672, 'guest', 'guest',
            '/', false, 'plain', null, 'en_US',
            3.0, 3.0, null, false, 60
        );

        // 2. åˆå§‹åŒ– Redisï¼ˆç”¨äºå¹‚ç­‰ï¼‰
        $this-&amp;gt;redis = new Redis();
        $this-&amp;gt;redis-&amp;gt;connect('redis', 6379);
    }

    /**
     * å¯é å‘é€æ¶ˆæ¯ï¼ˆå¤šå±‚é˜²æŠ¤ï¼‰
     * @param string $orderId ä¸šåŠ¡å”¯ä¸€ID
     * @param array $orderData è®¢å•æ•°æ®
     * @return bool æ˜¯å¦æˆåŠŸ
     */
    public function sendOrderCreated(string $orderId, array $orderData): bool
    {
        $lockKey = &quot;sent:order:{$orderId}&quot;;

        // === ç¬¬1å±‚ï¼šå¹‚ç­‰æ§åˆ¶ï¼ˆé˜²å¹¶å‘å‹æµ‹ï¼‰===
        $isFirstSend = $this-&amp;gt;redis-&amp;gt;set($lockKey, 1, ['nx', 'ex' =&amp;gt; 86400]);
        if (!$isFirstSend) {
            error_log(&quot;Duplicate request ignored: {$orderId}&quot;);
            return true; // å¹‚ç­‰è¿”å›æˆåŠŸ
        }

        $channel = null;
        try {
            $channel = $this-&amp;gt;connection-&amp;gt;channel();

            // === ç¬¬2å±‚ï¼šå£°æ˜èµ„æºï¼ˆå¹‚ç­‰æ“ä½œï¼‰===
            $exchange = 'orders';
            $queue = 'order.created';
            $routingKey = 'order.created';

            $channel-&amp;gt;exchange_declare($exchange, 'direct', false, true, false);
            $channel-&amp;gt;queue_declare($queue, false, true, false, false);
            $channel-&amp;gt;queue_bind($queue, $exchange, $routingKey);

            // === ç¬¬3å±‚ï¼šæ„é€ æŒä¹…åŒ–æ¶ˆæ¯ + mandatory ===
            $messageId = 'order:' . $orderId . ':' . str_replace('.', '', microtime(true));
            $msg = new AMQPMessage(
                json_encode([
                    'message_id' =&amp;gt; $messageId,
                    'order_id'   =&amp;gt; $orderId,
                    'data'       =&amp;gt; $orderData,
                    'timestamp'  =&amp;gt; time()
                ]),
                [
                    'delivery_mode' =&amp;gt; AMQPMessage::DELIVERY_MODE_PERSISTENT, // æŒä¹…åŒ–
                    'content_type'  =&amp;gt; 'application/json',
                    'message_id'    =&amp;gt; $messageId,
                    'mandatory'     =&amp;gt; true  // å…³é”®ï¼šè·¯ç”±å¤±è´¥è¿”å›ç»™ç”Ÿäº§è€…
                ]
            );

            // === ç¬¬4å±‚ï¼šå¼€å¯ Publisher Confirms ===
            $channel-&amp;gt;confirm_select();

            $acked = false;
            $nacked = false;
            $returned = false;

            // è®¾ç½® ack/nack å›è°ƒ
            $channel-&amp;gt;set_ack_handler(function (AMQPMessage $message) use (&amp;amp;$acked, $messageId) {
                if ($message-&amp;gt;get('message_id') === $messageId) {
                    $acked = true;
                    error_log(&quot;âœ… [CONFIRMED] Message acked: {$messageId}&quot;);
                }
            });

            $channel-&amp;gt;set_nack_handler(function (AMQPMessage $message) use (&amp;amp;$nacked, $messageId) {
                if ($message-&amp;gt;get('message_id') === $messageId) {
                    $nacked = true;
                    error_log(&quot;âŒ [FAILED] Message nacked: {$messageId}&quot;);
                }
            });

            // è®¾ç½® return å›è°ƒï¼ˆè·¯ç”±å¤±è´¥ï¼‰
            $channel-&amp;gt;set_return_listener(function ($replyCode, $replyText, $exchange, $routingKey, AMQPMessage $message) use (&amp;amp;$returned, $messageId) {
                $returned = true;
                error_log(&quot;ğŸš¨ [RETURNED] Message returned: {$replyCode} {$replyText}, msg: {$messageId}&quot;);
                // å¯è®°å½•åˆ°æ•°æ®åº“ï¼Œäººå·¥å¤„ç†
            });

            // === ç¬¬5å±‚ï¼šå‘é€æ¶ˆæ¯ ===
            $channel-&amp;gt;basic_publish($msg, $exchange, $routingKey);

            // === ç¬¬6å±‚ï¼šç­‰å¾… Broker ç¡®è®¤ï¼ˆåŒæ­¥é˜»å¡ï¼Œæœ€å¤š5ç§’ï¼‰===
            $channel-&amp;gt;wait_for_pending_acks_returns(5.0);

            // === ç¬¬7å±‚ï¼šåˆ¤æ–­ç»“æœ ===
            if ($nacked) {
                throw new Exception(&quot;Broker nack'd the message (e.g., queue full)&quot;);
            }
            if ($returned) {
                throw new Exception(&quot;Message was returned (routing failed)&quot;);
            }
            if (!$acked) {
                throw new Exception(&quot;No ack received (network issue or broker down)&quot;);
            }

            // âœ… æˆåŠŸï¼šæ¶ˆæ¯å·²å…¥é˜Ÿå¹¶æŒä¹…åŒ–
            error_log(&quot;ğŸ‰ Message successfully persisted to queue: {$messageId}&quot;);
            return true;

        } catch (Exception $e) {
            // === ç¬¬8å±‚ï¼šå¤±è´¥å›æ»šå¹‚ç­‰æ ‡è®°ï¼ˆå…è®¸é‡è¯•ï¼‰===
            $this-&amp;gt;redis-&amp;gt;del($lockKey);
            error_log(&quot;âŒ Send failed: {$e-&amp;gt;getMessage()} | Order: {$orderId}&quot;);
            return false;
        } finally {
            // æ¸…ç†èµ„æº
            if ($channel &amp;amp;&amp;amp; $channel-&amp;gt;is_open()) {
                $channel-&amp;gt;close();
            }
        }
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;è°ƒç”¨ç¤ºä¾‹&quot;&gt;è°ƒç”¨ç¤ºä¾‹&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;$producer = new ReliableRabbitMQProducer();
$success = $producer-&amp;gt;sendOrderCreated('123456', ['amount' =&amp;gt; 99.9, 'user_id' =&amp;gt; 789]);

if ($success) {
    echo &quot;æ¶ˆæ¯å·²å¯é æŠ•é€’\n&quot;;
} else {
    echo &quot;æŠ•é€’å¤±è´¥ï¼Œè¯·é‡è¯•æˆ–å‘Šè­¦\n&quot;;
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;æ¶ˆæ¯æŒä¹…åŒ–&quot;&gt;æ¶ˆæ¯æŒä¹…åŒ–&lt;/h3&gt;

&lt;h3 id=&quot;å¹‚ç­‰å¤„ç†&quot;&gt;å¹‚ç­‰å¤„ç†&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;æµç¨‹å›¾
    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;+----------------+     +------------------+     +------------------+
|   HTTP Client  | --&amp;gt; |   PHP-FPM        | --&amp;gt; |   RabbitMQ       |
| (å¹¶å‘å‹æµ‹)     |     | (ç”Ÿäº§è€…é€»è¾‘)      |     | (æ¶ˆæ¯é˜Ÿåˆ—)       |
+----------------+     +------------------+     +------------------+
                           |
                           | 1. æå– order_id
                           v
                     +------------------+
                     |   Redis: SET NX  |
                     | sent:order:X     |
                     | NX EX 3600       |
                     +------------------+
                           |
                  true â†’ å‘é€æ¶ˆæ¯
                          â†³ success â†’ å®Œæˆ âœ…
                          â†³ failure â†’ DEL æ ‡è®° â†’ è¿”å›é”™è¯¯ âš ï¸
                  false â†’ è¿”å›æˆåŠŸï¼ˆå¹‚ç­‰ï¼‰âœ…
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;ä»£ç 
    &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;public function sendOrderCreated(string $orderId, array $data): bool
{
  $lockKey = &quot;sent:order:{$orderId}&quot;;
  $tempKey = &quot;temp:order:{$orderId}&quot;; // å¯é€‰ï¼šç”¨ä¸´æ—¶æ ‡è®°

  // æ–¹æ¡ˆ Aï¼šç›´æ¥ SET NXï¼ˆç®€å•ï¼‰
  $isFirst = $this-&amp;gt;redis-&amp;gt;set($lockKey, 1, ['nx', 'ex' =&amp;gt; 3600]);

  if (!$isFirst) {
      return true; // å¹‚ç­‰
  }

  // å‘é€æ¶ˆæ¯
  try {
      $this-&amp;gt;doPublish($orderId, $data);
      return true; // æˆåŠŸ
  } catch (Exception $e) {
      // å…³é”®ï¼šå‘é€å¤±è´¥ï¼Œæ¸…é™¤æ ‡è®°ï¼
      $this-&amp;gt;redis-&amp;gt;del($lockKey);
      error_log(&quot;Publish failed, rollback mark: {$orderId}&quot;);
      return false;
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;h2 id=&quot;ï¸-rabbitmq-æ¶ˆè´¹è€…é˜²é‡å¤æ¶ˆè´¹ä¸å¹‚ç­‰å¤„ç†å®Œæ•´æ–¹æ¡ˆ&quot;&gt;ğŸ›¡ï¸ RabbitMQ æ¶ˆè´¹è€…é˜²é‡å¤æ¶ˆè´¹ä¸å¹‚ç­‰å¤„ç†å®Œæ•´æ–¹æ¡ˆ&lt;/h2&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;æ ¸å¿ƒæ€æƒ³&lt;/strong&gt;ï¼šRabbitMQ åªä¿è¯â€œè‡³å°‘ä¸€æ¬¡â€æˆ–â€œè‡³å¤šä¸€æ¬¡â€äº¤ä»˜ï¼Œ&lt;strong&gt;ä¸ä¿è¯â€œæ°å¥½ä¸€æ¬¡â€&lt;/strong&gt;ã€‚å› æ­¤ï¼Œæ¶ˆè´¹è€…å¿…é¡»å…·å¤‡&lt;strong&gt;è¯†åˆ«é‡å¤æ¶ˆæ¯ã€å®‰å…¨å¿½ç•¥é‡å¤ã€ä¿è¯ä¸šåŠ¡å¹‚ç­‰&lt;/strong&gt;çš„èƒ½åŠ›ï¼Œå¦åˆ™å°†å¯¼è‡´èµ„æŸã€æ•°æ®é”™ä¹±ç­‰ä¸¥é‡é—®é¢˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;ä¸€ä¸ºä»€ä¹ˆå¿…é¡»å¤„ç†é‡å¤æ¶ˆè´¹&quot;&gt;ä¸€ã€ä¸ºä»€ä¹ˆå¿…é¡»å¤„ç†é‡å¤æ¶ˆè´¹ï¼Ÿ&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;åŸå› &lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ” ç½‘ç»œæŠ–åŠ¨æˆ–å¤„ç†è¶…æ—¶&lt;/td&gt;
      &lt;td&gt;RabbitMQ æœªæ”¶åˆ° ACKï¼Œé‡æŠ•æ¶ˆæ¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ’¥ æ¶ˆè´¹è€…å´©æºƒ&lt;/td&gt;
      &lt;td&gt;ä¸šåŠ¡å·²æ‰§è¡Œä½†æœª ACKï¼Œé‡å¯åæ¶ˆæ¯é‡å‘&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ§± æ‰‹åŠ¨ ACK é—æ¼&lt;/td&gt;
      &lt;td&gt;ä»£ç  Bug å¯¼è‡´å¿˜è®° &lt;code class=&quot;highlighter-rouge&quot;&gt;basic_ack()&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ”„ é›†ç¾¤ HA åˆ‡æ¢&lt;/td&gt;
      &lt;td&gt;é•œåƒé˜Ÿåˆ—ä¸»ä»åˆ‡æ¢å¯èƒ½è§¦å‘é‡å‘&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ“¤ ç”Ÿäº§è€…é‡è¯•&lt;/td&gt;
      &lt;td&gt;ç½‘ç»œé—®é¢˜å¯¼è‡´åŒä¸€æ¡æ¶ˆæ¯è¢«å‘å¤šæ¬¡&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;ğŸ‘‰ &lt;strong&gt;ç»“è®ºï¼šé‡å¤æ¶ˆè´¹æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¸¸æ€ï¼Œå¿…é¡»è®¾è®¡å¹‚ç­‰æœºåˆ¶åº”å¯¹ã€‚&lt;/strong&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;äºŒå¹‚ç­‰æ€§æ¶ˆè´¹è€…çš„ç”Ÿå‘½çº¿&quot;&gt;äºŒã€å¹‚ç­‰æ€§ï¼šæ¶ˆè´¹è€…çš„ç”Ÿå‘½çº¿&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;å®šä¹‰&lt;/strong&gt;ï¼šæ— è®ºåŒä¸€æ¡æ¶ˆæ¯è¢«æ¶ˆè´¹å¤šå°‘æ¬¡ï¼Œç³»ç»Ÿçš„ä¸šåŠ¡çŠ¶æ€å’Œæœ€ç»ˆç»“æœéƒ½ä¸åªæ¶ˆè´¹ä¸€æ¬¡ç›¸åŒã€‚&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;-å¹‚ç­‰ä¸æ˜¯å¯é€‰é¡¹è€Œæ˜¯ç”Ÿäº§ç¯å¢ƒçš„å¿…é€‰é¡¹&quot;&gt;âœ… å¹‚ç­‰ä¸æ˜¯â€œå¯é€‰é¡¹â€ï¼Œè€Œæ˜¯&lt;strong&gt;ç”Ÿäº§ç¯å¢ƒçš„å¿…é€‰é¡¹&lt;/strong&gt;ã€‚&lt;/h4&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;ä¸‰äº”å¤§å¹‚ç­‰ç­–ç•¥æŒ‰æ¨èåº¦æ’åº&quot;&gt;ä¸‰ã€äº”å¤§å¹‚ç­‰ç­–ç•¥ï¼ˆæŒ‰æ¨èåº¦æ’åºï¼‰&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ–¹æ¡ˆ&lt;/th&gt;
      &lt;th&gt;åŸç†&lt;/th&gt;
      &lt;th&gt;é€‚ç”¨åœºæ™¯&lt;/th&gt;
      &lt;th&gt;ä¼˜ç‚¹&lt;/th&gt;
      &lt;th&gt;ç¼ºç‚¹&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1ï¸âƒ£ &lt;strong&gt;åŸºäº &lt;code class=&quot;highlighter-rouge&quot;&gt;message_id&lt;/code&gt; + Redis/NX&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ¶ˆè´¹å‰ç”¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;SET message_id NX EX&lt;/code&gt; åˆ¤æ–­æ˜¯å¦å·²å¤„ç†&lt;/td&gt;
      &lt;td&gt;é€šç”¨åœºæ™¯ï¼Œå°¤å…¶å¼‚æ­¥æ¶ˆæ¯&lt;/td&gt;
      &lt;td&gt;âœ… ç®€å•é«˜æ•ˆ&lt;br /&gt;âœ… åˆ†å¸ƒå¼å‹å¥½&lt;br /&gt;âœ… å¯è®¾ç½®è¿‡æœŸ&lt;/td&gt;
      &lt;td&gt;âŒ ä¾èµ– Redis å¯ç”¨æ€§&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2ï¸âƒ£ &lt;strong&gt;åŸºäºä¸šåŠ¡ä¸»é”®ï¼ˆå¦‚ order_idï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ç”¨ä¸šåŠ¡å”¯ä¸€ ID åˆ¤æ–­æ˜¯å¦å·²å¤„ç†&lt;/td&gt;
      &lt;td&gt;æœ‰æ˜ç¡®ä¸šåŠ¡æ ‡è¯†çš„åœºæ™¯&lt;/td&gt;
      &lt;td&gt;âœ… æ— éœ€å…¨å±€ ID&lt;br /&gt;âœ… è´´è¿‘ä¸šåŠ¡é€»è¾‘&lt;/td&gt;
      &lt;td&gt;âŒ åŒä¸€ä¸šåŠ¡å¯èƒ½å¤šæ¬¡åˆæ³•æ›´æ–°ï¼ˆå¦‚çŠ¶æ€å˜æ›´ï¼‰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3ï¸âƒ£ &lt;strong&gt;æ•°æ®åº“å”¯ä¸€çº¦æŸ&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ’å…¥æ—¶ä¾èµ– &lt;code class=&quot;highlighter-rouge&quot;&gt;UNIQUE KEY&lt;/code&gt; æŠ¥é”™&lt;/td&gt;
      &lt;td&gt;æ•°æ®å…¥åº“ã€ç”¨æˆ·æ³¨å†Œç­‰&lt;/td&gt;
      &lt;td&gt;âœ… å¼ºä¸€è‡´æ€§&lt;br /&gt;âœ… ä¸ä¾èµ–å¤–éƒ¨ç¼“å­˜&lt;/td&gt;
      &lt;td&gt;âŒ æ€§èƒ½å·®&lt;br /&gt;âŒ éœ€æ•è·å¼‚å¸¸&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4ï¸âƒ£ &lt;strong&gt;çŠ¶æ€æœºæ§åˆ¶&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ä¸šåŠ¡çŠ¶æ€åªèƒ½å•å‘æµè½¬ï¼ˆå¦‚ï¼šå¾…æ”¯ä»˜ â†’ å·²æ”¯ä»˜ï¼‰&lt;/td&gt;
      &lt;td&gt;æœ‰ä¸¥æ ¼çŠ¶æ€æµè½¬çš„ä¸šåŠ¡&lt;/td&gt;
      &lt;td&gt;âœ… å¤©ç„¶é˜²é‡&lt;br /&gt;âœ… æ— é¢å¤–å­˜å‚¨&lt;/td&gt;
      &lt;td&gt;âŒ ä¸é€‚ç”¨äºå¹‚ç­‰æ›´æ–°ï¼ˆå¦‚å¤šæ¬¡åŠ ç§¯åˆ†ï¼‰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5ï¸âƒ£ &lt;strong&gt;æœ¬åœ°æ–‡ä»¶æˆ–å†…å­˜æ ‡è®°&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;å•æœºè„šæœ¬å¯ç”¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;flock()&lt;/code&gt; æˆ–æ•°ç»„ç¼“å­˜&lt;/td&gt;
      &lt;td&gt;å•æœºã€ä½é¢‘åœºæ™¯&lt;/td&gt;
      &lt;td&gt;âœ… ç®€å•&lt;/td&gt;
      &lt;td&gt;âŒ ä¸æ”¯æŒåˆ†å¸ƒå¼&lt;br /&gt;âŒ é‡å¯ä¸¢å¤±&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;blockquote&gt;
  &lt;p&gt;âœ… &lt;strong&gt;æ¨èç»„åˆ&lt;/strong&gt;ï¼š&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;å¸¸è§„ä¸šåŠ¡ï¼š&lt;strong&gt;æ–¹æ¡ˆ 1ï¼ˆ&lt;code class=&quot;highlighter-rouge&quot;&gt;message_id&lt;/code&gt; + Redisï¼‰&lt;/strong&gt;&lt;/li&gt;
    &lt;li&gt;æ ¸å¿ƒäº¤æ˜“ï¼š&lt;strong&gt;æ–¹æ¡ˆ 1 + æ–¹æ¡ˆ 3ï¼ˆæ•°æ®åº“å”¯ä¸€é”®ï¼‰åŒé‡ä¿é™©&lt;/strong&gt;&lt;/li&gt;
    &lt;li&gt;çŠ¶æ€é©±åŠ¨ï¼š&lt;strong&gt;æ–¹æ¡ˆ 4ï¼ˆçŠ¶æ€æœºï¼‰ä¸ºä¸»ï¼Œè¾…ä»¥æ–¹æ¡ˆ 1&lt;/strong&gt;&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;å››æ¶ˆè´¹è€…å¼€å‘åå¤§å…³é”®å®è·µæ•´åˆå¯é æ€§ä¸å¯ç»´æŠ¤æ€§&quot;&gt;å››ã€æ¶ˆè´¹è€…å¼€å‘åå¤§å…³é”®å®è·µï¼ˆæ•´åˆå¯é æ€§ä¸å¯ç»´æŠ¤æ€§ï¼‰&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;ç±»åˆ«&lt;/th&gt;
      &lt;th&gt;å®è·µè¦ç‚¹&lt;/th&gt;
      &lt;th&gt;è¯´æ˜&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ” &lt;strong&gt;1. æ‰‹åŠ¨ ACK&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ç¦ç”¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;auto_ack=true&lt;/code&gt;ï¼Œä¸šåŠ¡å®Œæˆå &lt;code class=&quot;highlighter-rouge&quot;&gt;basic_ack()&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;é˜²æ­¢æœªå¤„ç†å®Œå°±ç¡®è®¤ï¼Œé¿å…æ¶ˆæ¯ä¸¢å¤±&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;âš–ï¸ &lt;strong&gt;2. å…¬å¹³åˆ†å‘ï¼ˆQoSï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;basic_qos(null, 1, null)&lt;/code&gt; æ§åˆ¶æœª ACK æ¶ˆæ¯æ•°&lt;/td&gt;
      &lt;td&gt;é¿å…æŸæ¶ˆè´¹è€…è¿‡è½½ï¼Œæå‡è´Ÿè½½å‡è¡¡&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ§¼ &lt;strong&gt;3. ä¼˜é›…å…³é—­&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ•è· &lt;code class=&quot;highlighter-rouge&quot;&gt;SIGTERM&lt;/code&gt;ï¼Œåœæ­¢ &lt;code class=&quot;highlighter-rouge&quot;&gt;wait()&lt;/code&gt; å¹¶ç­‰å¾…å½“å‰æ¶ˆæ¯å¤„ç†å®Œ&lt;/td&gt;
      &lt;td&gt;é˜²æ­¢å¼ºåˆ¶é€€å‡ºå¯¼è‡´æ¶ˆæ¯é‡æŠ•&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ—‘ï¸ &lt;strong&gt;4. æ­»ä¿¡é˜Ÿåˆ—ï¼ˆDLXï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;é…ç½® DLX å¤„ç†é‡è¯•è¶…é™çš„æ¶ˆæ¯&lt;/td&gt;
      &lt;td&gt;é¿å…æ— é™é‡å…¥é˜Ÿï¼Œä¾¿äºé—®é¢˜æ’æŸ¥&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ•’ &lt;strong&gt;5. æ§åˆ¶å¤„ç†æ—¶é•¿&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;é¿å…é˜»å¡æ“ä½œï¼Œè®¾ç½® &lt;code class=&quot;highlighter-rouge&quot;&gt;read_write_timeout&lt;/code&gt;&lt;/td&gt;
      &lt;td&gt;é˜²æ­¢å¿ƒè·³è¶…æ—¶å¯¼è‡´è¿æ¥æ–­å¼€&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ” &lt;strong&gt;6. é‡è¯•ç­–ç•¥&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;å¤±è´¥å &lt;code class=&quot;highlighter-rouge&quot;&gt;nack(true)&lt;/code&gt; é‡è¯•æœ‰é™æ¬¡æ•°ï¼ˆå¦‚ 3 æ¬¡ï¼‰&lt;/td&gt;
      &lt;td&gt;é˜²æ­»å¾ªç¯ï¼Œç»“åˆ DLX ä½¿ç”¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ“Š &lt;strong&gt;7. æ—¥å¿—ä¸ç›‘æ§&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;è®°å½• &lt;code class=&quot;highlighter-rouge&quot;&gt;message_id&lt;/code&gt;ã€å¤„ç†ç»“æœã€é‡è¯•æ¬¡æ•°&lt;/td&gt;
      &lt;td&gt;ä¾¿äºè¿½è¸ªé—®é¢˜ï¼Œæ”¯æŒå¯¹è´¦&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ†” &lt;strong&gt;8. å”¯ä¸€æ ‡è¯†ä¼ é€’&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ¶ˆæ¯ä½“å¿…é¡»åŒ…å« &lt;code class=&quot;highlighter-rouge&quot;&gt;message_id&lt;/code&gt;ï¼ˆç”Ÿäº§è€…ç”Ÿæˆï¼‰&lt;/td&gt;
      &lt;td&gt;å¹‚ç­‰å»é‡çš„ä¾æ®&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ§© &lt;strong&gt;9. å¹‚ç­‰ä¼˜å…ˆäºé‡è¯•&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;å…ˆåˆ¤æ–­æ˜¯å¦å·²å¤„ç†ï¼Œå†å†³å®šæ˜¯å¦æ‰§è¡Œä¸šåŠ¡&lt;/td&gt;
      &lt;td&gt;å‡å°‘æ— æ•ˆé‡è¯•ï¼Œæå‡æ€§èƒ½&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ğŸ§ª &lt;strong&gt;10. å‹æµ‹éªŒè¯&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ¨¡æ‹Ÿç½‘ç»œæŠ–åŠ¨ã€æ¶ˆè´¹è€…å´©æºƒï¼ŒéªŒè¯å»é‡æœ‰æ•ˆæ€§&lt;/td&gt;
      &lt;td&gt;ç¡®ä¿æ–¹æ¡ˆåœ¨ç”Ÿäº§ç¯å¢ƒå¯é &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;äº”å®Œæ•´å¤„ç†æµç¨‹ä»¥-php-ä¸ºä¾‹&quot;&gt;äº”ã€å®Œæ•´å¤„ç†æµç¨‹ï¼ˆä»¥ PHP ä¸ºä¾‹ï¼‰&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[æ¥æ”¶æ¶ˆæ¯]
     â†“
[æå– message_id]
     â†“
[Redis SET message_id NX EX 86400]
     â†“
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ å·²å­˜åœ¨ï¼ŸYES  â”‚ â†’ ç›´æ¥ ACKï¼Œè·³è¿‡ä¸šåŠ¡ âœ…
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“ NO
[æ‰§è¡Œä¸šåŠ¡é€»è¾‘]
     â†“
[æˆåŠŸ] â†’ ACK âœ…
[å¤±è´¥] â†’ å¯é€‰ï¼šåˆ é™¤ Redis æ ‡è®° â†’ NACKï¼ˆé‡è¯•æˆ–è¿› DLXï¼‰âš ï¸

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;âœ… å…³é”®ç‚¹ï¼š&lt;/p&gt;
  &lt;ul&gt;
    &lt;li&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;SET NX&lt;/code&gt; æ˜¯åŸå­æ“ä½œï¼Œé˜²å¹¶å‘é‡å¤å¤„ç†&lt;/li&gt;
    &lt;li&gt;ä¸šåŠ¡æˆåŠŸåæ‰ ACKï¼Œå¤±è´¥å¯å›æ»šæ ‡è®°å…è®¸é‡è¯•&lt;/li&gt;
    &lt;li&gt;é‡è¯•æ¬¡æ•°è¶…é™ â†’ è¿› DLXï¼Œäººå·¥ä»‹å…¥&lt;/li&gt;
  &lt;/ul&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;å…­æ€»ç»“æ„å»ºé›¶èµ„æŸæ¶ˆè´¹è€…ä½“ç³»çš„å››å¤§æ”¯æŸ±&quot;&gt;å…­ã€æ€»ç»“ï¼šæ„å»ºâ€œé›¶èµ„æŸâ€æ¶ˆè´¹è€…ä½“ç³»çš„å››å¤§æ”¯æŸ±&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ”¯æŸ±&lt;/th&gt;
      &lt;th&gt;å†…æ¶µ&lt;/th&gt;
      &lt;th&gt;è½åœ°åŠ¨ä½œ&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1ï¸âƒ£ &lt;strong&gt;è®¤çŸ¥åˆ°ä½&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ¥å—â€œé‡å¤æ¶ˆè´¹æ˜¯å¸¸æ€â€&lt;/td&gt;
      &lt;td&gt;è®¾è®¡æ—¶é»˜è®¤æ¶ˆæ¯å¯èƒ½é‡å¤&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2ï¸âƒ£ &lt;strong&gt;å¹‚ç­‰ä¼˜å…ˆ&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ä¸šåŠ¡å±‚å…·å¤‡å»é‡èƒ½åŠ›&lt;/td&gt;
      &lt;td&gt;é‡‡ç”¨ &lt;code class=&quot;highlighter-rouge&quot;&gt;message_id&lt;/code&gt; + Redis ç­‰æ–¹æ¡ˆ&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3ï¸âƒ£ &lt;strong&gt;æœºåˆ¶å¥å…¨&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ACKã€QoSã€DLXã€ç›‘æ§å…¨è¦†ç›–&lt;/td&gt;
      &lt;td&gt;é¿å…æŠ€æœ¯æ€§é‡å¤ï¼ˆå¦‚æœª ACKï¼‰&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4ï¸âƒ£ &lt;strong&gt;éªŒè¯å……åˆ†&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;å‹æµ‹ + å¯¹è´¦ + ç›‘æ§&lt;/td&gt;
      &lt;td&gt;ç¡®ä¿æ–¹æ¡ˆåœ¨çœŸå®åœºæ™¯ä¸­å¯é &lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;-æœ€ç»ˆå»ºè®®&quot;&gt;âœ… æœ€ç»ˆå»ºè®®&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;ä¸è¦ä¾èµ– RabbitMQ ä¿è¯â€œåªæ¶ˆè´¹ä¸€æ¬¡â€&lt;/strong&gt; â€”â€” å®ƒæ²¡æœ‰è¿™ä¸ªè¯­ä¹‰ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¸è¦æŠŠâ€œæ²¡æŠ¥é”™â€å½“æˆâ€œæˆåŠŸâ€&lt;/strong&gt; â€”â€” å¿…é¡» ACK æ‰ç®—å®Œæˆã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;ä¸è¦æŠŠâ€œé‡è¯•â€å½“â€œå®¹é”™â€&lt;/strong&gt; â€”â€” æ— å¹‚ç­‰çš„é‡è¯•æ˜¯ç¾éš¾ã€‚&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;æŠŠâ€œå¹‚ç­‰â€å½“ä½œå’Œâ€œä¸šåŠ¡é€»è¾‘â€åŒç­‰é‡è¦çš„æ¨¡å—æ¥è®¾è®¡&lt;/strong&gt;ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;ğŸ’¡ &lt;strong&gt;é‡‘å¥æ€»ç»“&lt;/strong&gt;ï¼š&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;åœ¨æ¶ˆæ¯é©±åŠ¨çš„ç³»ç»Ÿä¸­ï¼Œæ¶ˆè´¹è€…ä¸æ˜¯â€œæ‰§è¡Œè€…â€ï¼Œè€Œæ˜¯â€œå†³ç­–è€…â€â€”â€”å®ƒå¿…é¡»åˆ¤æ–­ï¼šè¿™æ¡æ¶ˆæ¯æˆ‘ä»¥å‰è§è¿‡å—ï¼Ÿæˆ‘ç°åœ¨è¯¥å¤„ç†å—ï¼Ÿå¤„ç†é”™äº†èƒ½å›æ»šå—ï¼Ÿåªæœ‰æƒ³æ¸…æ¥šè¿™ä¸‰ä¸ªé—®é¢˜ï¼Œç³»ç»Ÿæ‰èƒ½çœŸæ­£å¯é ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;ä¸€äº”å¤§æ ¸å¿ƒæ¨¡å—ç³»ç»Ÿéª¨æ¶&quot;&gt;ä¸€ã€äº”å¤§æ ¸å¿ƒæ¨¡å—ï¼ˆç³»ç»Ÿéª¨æ¶ï¼‰&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;æ¨¡å—&lt;/th&gt;
      &lt;th&gt;èŒè´£&lt;/th&gt;
      &lt;th&gt;å¯¹åº”ä»£ç æ–‡ä»¶&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;1ï¸âƒ£ &lt;strong&gt;é…ç½®ç®¡ç†å±‚&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;ç»Ÿä¸€ç®¡ç† RabbitMQã€Redisã€é˜Ÿåˆ—ã€æ­»ä¿¡ç­‰å‚æ•°ï¼Œä¸ç¯å¢ƒè§£è€¦ï¼Œæ”¯æŒå¤šç¯å¢ƒçµæ´»åˆ‡æ¢&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;config/rabbitmq.php&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;2ï¸âƒ£ &lt;strong&gt;è¿æ¥èµ„æºç®¡ç†&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;åˆå§‹åŒ–å¹¶ç»´æŠ¤ RabbitMQ è¿æ¥ã€Channelã€Redis è¿æ¥æ± ï¼Œç¡®ä¿èµ„æºç”Ÿå‘½å‘¨æœŸå®‰å…¨ã€å¼‚å¸¸è‡ªåŠ¨æ¸…ç†&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;BaseConsumer::initializeRabbitMQ()&lt;/code&gt;&lt;br /&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;BaseConsumer::initializeRedis()&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;3ï¸âƒ£ &lt;strong&gt;æ¶ˆæ¯æ¶ˆè´¹å¼•æ“&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;å®ç°æ¶ˆè´¹å¾ªç¯ã€å›è°ƒåˆ†å‘ã€æ‰‹åŠ¨ ACK/NACK æ§åˆ¶ã€QoS å…¬å¹³åˆ†å‘ï¼Œä¿éšœæ¶ˆæ¯å¯é æŠ•é€’ä¸è´Ÿè½½å‡è¡¡&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;BaseConsumer::startConsuming()&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;4ï¸âƒ£ &lt;strong&gt;ä¸šåŠ¡å¤„ç†æ ¸å¿ƒ&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æŠ½è±¡ä¸šåŠ¡å¤„ç†é€»è¾‘ï¼Œå†…ç½®å¹‚ç­‰å»é‡ã€äº‹åŠ¡æ§åˆ¶ã€é‡è¯•æœºåˆ¶ã€æ­»ä¿¡ç­–ç•¥ï¼Œç¡®ä¿ä¸šåŠ¡æ‰§è¡Œçš„å‡†ç¡®æ€§å’Œå®¹é”™æ€§&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;BaseConsumer::onMessage()&lt;/code&gt;&lt;br /&gt;+ å­ç±» &lt;code class=&quot;highlighter-rouge&quot;&gt;processMessage()&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;5ï¸âƒ£ &lt;strong&gt;è¿ç»´æ”¯æ’‘ä½“ç³»&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æä¾›ç»“æ„åŒ–æ—¥å¿—ã€ç›‘æ§åŸ‹ç‚¹ã€ä¼˜é›…å…³é—­ï¼ˆä¿¡å·å¤„ç†ï¼‰ã€Supervisor è¿›ç¨‹æ‰˜ç®¡ï¼Œä¿éšœç³»ç»Ÿå¯è§‚æµ‹æ€§ä¸é«˜å¯ç”¨&lt;/td&gt;
      &lt;td&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;BaseConsumer::signalHandler()&lt;/code&gt;&lt;br /&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;bin/consumer.php&lt;/code&gt;&lt;br /&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;supervisor/*.conf&lt;/code&gt;&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸€ã€ é…ç½®æ–‡ä»¶ (config/rabbitmq.php)&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
return [
    // RabbitMQ è¿æ¥é…ç½®
    'rabbitmq' =&amp;gt; [
        'host' =&amp;gt; 'rabbitmq-host',
        'port' =&amp;gt; 5672,
        'username' =&amp;gt; 'your_username',
        'password' =&amp;gt; 'your_password',
        'vhost' =&amp;gt; '/',
        'heartbeat' =&amp;gt; 60,
        'read_write_timeout' =&amp;gt; 60,
    ],
    
    // é˜Ÿåˆ—é…ç½®
    'queues' =&amp;gt; [
        'order.created' =&amp;gt; [
            'name' =&amp;gt; 'order.created',
            'exchange' =&amp;gt; 'orders',
            'routing_key' =&amp;gt; 'order.created',
            'durable' =&amp;gt; true,
            'prefetch' =&amp;gt; 1, // å…¬å¹³åˆ†å‘
            'retry_count' =&amp;gt; 3, // æœ€å¤§é‡è¯•æ¬¡æ•°
            'retry_delay' =&amp;gt; 5000, // é‡è¯•å»¶è¿Ÿ(æ¯«ç§’)
        ],
        'payment.success' =&amp;gt; [
            'name' =&amp;gt; 'payment.success',
            'exchange' =&amp;gt; 'payments',
            'routing_key' =&amp;gt; 'payment.success',
            'durable' =&amp;gt; true,
            'prefetch' =&amp;gt; 2,
            'retry_count' =&amp;gt; 5,
            'retry_delay' =&amp;gt; 10000,
        ],
    ],
    
    // Redis é…ç½®ï¼ˆç”¨äºå¹‚ç­‰ï¼‰
    'redis' =&amp;gt; [
        'host' =&amp;gt; 'redis-host',
        'port' =&amp;gt; 6379,
        'password' =&amp;gt; '',
        'database' =&amp;gt; 0,
        'timeout' =&amp;gt; 3,
    ],
    
    // æ­»ä¿¡é˜Ÿåˆ—é…ç½®
    'dead_letter' =&amp;gt; [
        'enabled' =&amp;gt; true,
        'exchange' =&amp;gt; 'dlx.orders',
        'queue' =&amp;gt; 'dlx.order.created',
        'ttl' =&amp;gt; 60000, // æ¶ˆæ¯åœ¨é˜Ÿåˆ—ä¸­å­˜æ´»æ—¶é—´(æ¯«ç§’)
    ],
];
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;äºŒã€ æ ¸å¿ƒæ¶ˆè´¹è€…ç±» (app/Consumers/BaseConsumer.php)&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
namespace App\Consumers;

use PhpAmqpLib\Connection\AMQPStreamConnection;
use PhpAmqpLib\Message\AMQPMessage;
use PhpAmqpLib\Exception\AMQPTimeoutException;
use Redis;
use Psr\Log\LoggerInterface;

abstract class BaseConsumer
{
    protected $connection;
    protected $channel;
    protected $redis;
    protected $logger;
    protected $config;
    
    // ä¿¡å·æ§åˆ¶
    protected $shouldStop = false;
    protected $currentMessage = null;
    protected $currentStartTime = 0;

    public function __construct(array $config, LoggerInterface $logger)
    {
        $this-&amp;gt;config = $config;
        $this-&amp;gt;logger = $logger;
        $this-&amp;gt;setupSignalHandlers();
    }

    /**
     * åˆå§‹åŒ–è¿æ¥å’Œèµ„æº
     */
    public function initialize(): void
    {
        // åˆå§‹åŒ– Redis
        $this-&amp;gt;initializeRedis();
        
        // åˆå§‹åŒ– RabbitMQ è¿æ¥
        $this-&amp;gt;initializeRabbitMQ();
    }

    /**
     * åˆå§‹åŒ– Redis
     */
    protected function initializeRedis(): void
    {
        try {
            $this-&amp;gt;redis = new Redis();
            $redisConfig = $this-&amp;gt;config['redis'];
            
            if (!$this-&amp;gt;redis-&amp;gt;connect(
                $redisConfig['host'], 
                $redisConfig['port'], 
                $redisConfig['timeout']
            )) {
                throw new \Exception(&quot;Redis connection failed&quot;);
            }
            
            if (!empty($redisConfig['password'])) {
                $this-&amp;gt;redis-&amp;gt;auth($redisConfig['password']);
            }
            
            $this-&amp;gt;redis-&amp;gt;select($redisConfig['database']);
            
            $this-&amp;gt;logger-&amp;gt;info(&quot;Redis connected successfully&quot;);
        } catch (\Exception $e) {
            $this-&amp;gt;logger-&amp;gt;error(&quot;Redis initialization failed: &quot; . $e-&amp;gt;getMessage());
            throw $e;
        }
    }

    /**
     * åˆå§‹åŒ– RabbitMQ è¿æ¥
     */
    protected function initializeRabbitMQ(): void
    {
        try {
            $rabbitConfig = $this-&amp;gt;config['rabbitmq'];
            
            $this-&amp;gt;connection = new AMQPStreamConnection(
                $rabbitConfig['host'],
                $rabbitConfig['port'],
                $rabbitConfig['username'],
                $rabbitConfig['password'],
                $rabbitConfig['vhost'],
                false,
                'AMQPLAIN',
                null,
                'en_US',
                $rabbitConfig['read_write_timeout'],
                $rabbitConfig['read_write_timeout'],
                null,
                false,
                $rabbitConfig['heartbeat']
            );

            $this-&amp;gt;channel = $this-&amp;gt;connection-&amp;gt;channel();
            
            // è®¾ç½® QoSï¼ˆå…¬å¹³åˆ†å‘ï¼‰
            $this-&amp;gt;channel-&amp;gt;basic_qos(null, $this-&amp;gt;getPrefetchCount(), null);
            
            $this-&amp;gt;logger-&amp;gt;info(&quot;RabbitMQ connected successfully&quot;);
        } catch (\Exception $e) {
            $this-&amp;gt;logger-&amp;gt;error(&quot;RabbitMQ initialization failed: &quot; . $e-&amp;gt;getMessage());
            throw $e;
        }
    }

    /**
     * å£°æ˜é˜Ÿåˆ—å’Œç»‘å®š
     */
    protected function declareQueue(string $queueName): void
    {
        $queueConfig = $this-&amp;gt;config['queues'][$queueName];
        
        // å£°æ˜æ­»ä¿¡äº¤æ¢æœºå’Œé˜Ÿåˆ—ï¼ˆå¦‚æœå¯ç”¨ï¼‰
        if ($this-&amp;gt;config['dead_letter']['enabled']) {
            $this-&amp;gt;declareDeadLetter($queueName);
        }

        // å£°æ˜ä¸»é˜Ÿåˆ—
        $args = [];
        if ($this-&amp;gt;config['dead_letter']['enabled']) {
            $args['x-dead-letter-exchange'] = $this-&amp;gt;config['dead_letter']['exchange'];
            $args['x-dead-letter-routing-key'] = $this-&amp;gt;config['dead_letter']['queue'];
            $args['x-message-ttl'] = $this-&amp;gt;config['dead_letter']['ttl'];
        }

        $this-&amp;gt;channel-&amp;gt;queue_declare(
            $queueConfig['name'],
            false, // passive
            $queueConfig['durable'], // durable
            false, // exclusive
            false, // auto_delete
            false, // nowait
            $args // arguments
        );

        // å£°æ˜äº¤æ¢æœº
        $this-&amp;gt;channel-&amp;gt;exchange_declare(
            $queueConfig['exchange'],
            'direct', // type
            false, // passive
            $queueConfig['durable'], // durable
            false // auto_delete
        );

        // ç»‘å®šé˜Ÿåˆ—åˆ°äº¤æ¢æœº
        $this-&amp;gt;channel-&amp;gt;queue_bind(
            $queueConfig['name'],
            $queueConfig['exchange'],
            $queueConfig['routing_key']
        );

        $this-&amp;gt;logger-&amp;gt;info(&quot;Queue {$queueName} declared and bound successfully&quot;);
    }

    /**
     * å£°æ˜æ­»ä¿¡é˜Ÿåˆ—
     */
    protected function declareDeadLetter(string $queueName): void
    {
        $dlxConfig = $this-&amp;gt;config['dead_letter'];
        $queueConfig = $this-&amp;gt;config['queues'][$queueName];

        // å£°æ˜æ­»ä¿¡äº¤æ¢æœº
        $this-&amp;gt;channel-&amp;gt;exchange_declare(
            $dlxConfig['exchange'],
            'direct',
            false,
            true,
            false
        );

        // å£°æ˜æ­»ä¿¡é˜Ÿåˆ—
        $this-&amp;gt;channel-&amp;gt;queue_declare(
            $dlxConfig['queue'] . '.' . $queueName,
            false,
            true,
            false,
            false
        );

        // ç»‘å®šæ­»ä¿¡é˜Ÿåˆ—
        $this-&amp;gt;channel-&amp;gt;queue_bind(
            $dlxConfig['queue'] . '.' . $queueName,
            $dlxConfig['exchange'],
            $queueConfig['routing_key']
        );
    }

    /**
     * æ¶ˆæ¯å¤„ç†å‡½æ•°ï¼ˆå­ç±»å¿…é¡»å®ç°ï¼‰
     */
    abstract protected function processMessage(array $data, array $headers): bool;

    /**
     * è·å–æ¶ˆæ¯å»é‡é”®
     */
    protected function getDeduplicationKey(AMQPMessage $message): string
    {
        $data = json_decode($message-&amp;gt;getBody(), true);
        return $data['message_id'] ?? $message-&amp;gt;getDeliveryTag() . '_' . md5($message-&amp;gt;getBody());
    }

    /**
     * æ£€æŸ¥æ¶ˆæ¯æ˜¯å¦å·²å¤„ç†ï¼ˆå¹‚ç­‰æ€§ï¼‰
     */
    protected function isMessageProcessed(string $deduplicationKey): bool
    {
        $key = &quot;processed:message:{$deduplicationKey}&quot;;
        return $this-&amp;gt;redis-&amp;gt;exists($key);
    }

    /**
     * æ ‡è®°æ¶ˆæ¯å·²å¤„ç†
     */
    protected function markMessageProcessed(string $deduplicationKey, int $ttl = 86400): void
    {
        $key = &quot;processed:message:{$deduplicationKey}&quot;;
        $this-&amp;gt;redis-&amp;gt;setex($key, $ttl, 1);
    }

    /**
     * æ¶ˆæ¯æ¶ˆè´¹å›è°ƒ
     */
    public function onMessage(AMQPMessage $message): void
    {
        $this-&amp;gt;currentMessage = $message;
        $this-&amp;gt;currentStartTime = microtime(true);

        try {
            // æå–æ¶ˆæ¯å†…å®¹
            $data = json_decode($message-&amp;gt;getBody(), true);
            if (json_last_error() !== JSON_ERROR_NONE) {
                throw new \Exception(&quot;Invalid JSON: &quot; . json_last_error_msg());
            }

            $headers = $message-&amp;gt;get_properties();
            $deduplicationKey = $this-&amp;gt;getDeduplicationKey($message);

            $this-&amp;gt;logger-&amp;gt;info(&quot;Processing message&quot;, [
                'message_id' =&amp;gt; $data['message_id'] ?? 'unknown',
                'delivery_tag' =&amp;gt; $message-&amp;gt;getDeliveryTag(),
                'redelivered' =&amp;gt; $message-&amp;gt;isRedelivered()
            ]);

            // å¹‚ç­‰æ€§æ£€æŸ¥
            if ($this-&amp;gt;isMessageProcessed($deduplicationKey)) {
                $this-&amp;gt;logger-&amp;gt;info(&quot;Duplicate message detected, skipping&quot;, [
                    'message_id' =&amp;gt; $data['message_id'] ?? 'unknown'
                ]);
                $message-&amp;gt;ack();
                return;
            }

            // ä¸šåŠ¡å¤„ç†
            $success = $this-&amp;gt;processMessage($data, $headers);

            if ($success) {
                // æ ‡è®°æ¶ˆæ¯å·²å¤„ç†
                $this-&amp;gt;markMessageProcessed($deduplicationKey);
                
                // ç¡®è®¤æ¶ˆæ¯
                $message-&amp;gt;ack();
                
                $processingTime = round((microtime(true) - $this-&amp;gt;currentStartTime) * 1000, 2);
                $this-&amp;gt;logger-&amp;gt;info(&quot;Message processed successfully&quot;, [
                    'message_id' =&amp;gt; $data['message_id'] ?? 'unknown',
                    'processing_time_ms' =&amp;gt; $processingTime
                ]);
            } else {
                throw new \Exception(&quot;Business processing failed&quot;);
            }

        } catch (\Exception $e) {
            $this-&amp;gt;handleProcessingFailure($message, $e);
        } finally {
            $this-&amp;gt;currentMessage = null;
            $this-&amp;gt;currentStartTime = 0;
        }
    }

    /**
     * å¤„ç†å¤„ç†å¤±è´¥
     */
    protected function handleProcessingFailure(AMQPMessage $message, \Exception $e): void
    {
        $data = json_decode($message-&amp;gt;getBody(), true);
        $messageId = $data['message_id'] ?? 'unknown';
        
        $processingTime = round((microtime(true) - $this-&amp;gt;currentStartTime) * 1000, 2);
        
        $this-&amp;gt;logger-&amp;gt;error(&quot;Message processing failed&quot;, [
            'message_id' =&amp;gt; $messageId,
            'error' =&amp;gt; $e-&amp;gt;getMessage(),
            'processing_time_ms' =&amp;gt; $processingTime,
            'delivery_tag' =&amp;gt; $message-&amp;gt;getDeliveryTag(),
            'redelivered' =&amp;gt; $message-&amp;gt;isRedelivered()
        ]);

        // æ ¹æ®é‡è¯•æ¬¡æ•°å†³å®šæ˜¯å¦é‡è¯•æˆ–æ‹’ç»
        $retryCount = $this-&amp;gt;getCurrentRetryCount($message);
        $maxRetries = $this-&amp;gt;getMaxRetryCount();

        if ($retryCount &amp;lt; $maxRetries) {
            // é‡è¯•ï¼šé‡æ–°å…¥é˜Ÿ
            $this-&amp;gt;logger-&amp;gt;info(&quot;Retrying message&quot;, [
                'message_id' =&amp;gt; $messageId,
                'retry_count' =&amp;gt; $retryCount + 1,
                'max_retries' =&amp;gt; $maxRetries
            ]);
            
            // å»¶è¿Ÿé‡è¯•ï¼ˆé€šè¿‡ TTL å®ç°ï¼‰
            $message-&amp;gt;nack(false); // ä¸é‡æ–°å…¥é˜Ÿï¼Œç­‰å¾… TTL åè¿›å…¥æ­»ä¿¡æˆ–é‡æ–°å‘å¸ƒ
        } else {
            // è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ï¼Œæ‹’ç»æ¶ˆæ¯ï¼ˆè¿›å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼‰
            $this-&amp;gt;logger-&amp;gt;warning(&quot;Max retries exceeded, sending to dead letter&quot;, [
                'message_id' =&amp;gt; $messageId,
                'retry_count' =&amp;gt; $retryCount
            ]);
            
            $message-&amp;gt;nack(false); // æ‹’ç»ï¼Œä¸é‡æ–°å…¥é˜Ÿ
        }
    }

    /**
     * è·å–å½“å‰é‡è¯•æ¬¡æ•°
     */
    protected function getCurrentRetryCount(AMQPMessage $message): int
    {
        $headers = $message-&amp;gt;get_properties();
        $retryCount = $headers['application_headers']['x-retry-count'][1] ?? 0;
        return (int)$retryCount;
    }

    /**
     * è·å–æœ€å¤§é‡è¯•æ¬¡æ•°
     */
    protected function getMaxRetryCount(): int
    {
        return $this-&amp;gt;config['queues']['order.created']['retry_count'] ?? 3;
    }

    /**
     * è·å–é¢„å–è®¡æ•°
     */
    protected function getPrefetchCount(): int
    {
        return $this-&amp;gt;config['queues']['order.created']['prefetch'] ?? 1;
    }

    /**
     * è®¾ç½®ä¿¡å·å¤„ç†å™¨ï¼ˆä¼˜é›…å…³é—­ï¼‰
     */
    protected function setupSignalHandlers(): void
    {
        pcntl_signal(SIGTERM, [$this, 'signalHandler']);
        pcntl_signal(SIGINT, [$this, 'signalHandler']);
        pcntl_signal(SIGHUP, [$this, 'signalHandler']);
    }

    /**
     * ä¿¡å·å¤„ç†
     */
    public function signalHandler(int $signal): void
    {
        $this-&amp;gt;logger-&amp;gt;info(&quot;Received signal {$signal}, shutting down gracefully...&quot;);
        $this-&amp;gt;shouldStop = true;
    }

    /**
     * å¼€å§‹æ¶ˆè´¹
     */
    public function startConsuming(string $queueName): void
    {
        $this-&amp;gt;declareQueue($queueName);

        $this-&amp;gt;logger-&amp;gt;info(&quot;Starting consumer for queue: {$queueName}&quot;);

        $callback = function (AMQPMessage $message) {
            // æ£€æŸ¥æ˜¯å¦éœ€è¦åœæ­¢
            pcntl_signal_dispatch();
            if ($this-&amp;gt;shouldStop) {
                $this-&amp;gt;logger-&amp;gt;info(&quot;Stopping consumer due to shutdown signal&quot;);
                throw new \Exception(&quot;Consumer shutdown requested&quot;);
            }

            $this-&amp;gt;onMessage($message);
        };

        $queueConfig = $this-&amp;gt;config['queues'][$queueName];
        
        $this-&amp;gt;channel-&amp;gt;basic_consume(
            $queueConfig['name'],
            '', // consumer tag
            false, // no local
            false, // no ack (we do manual ack)
            false, // exclusive
            false, // no wait
            $callback
        );

        // ä¸»å¾ªç¯
        try {
            while (count($this-&amp;gt;channel-&amp;gt;callbacks) &amp;amp;&amp;amp; !$this-&amp;gt;shouldStop) {
                $this-&amp;gt;channel-&amp;gt;wait(null, false, 1); // 1ç§’è¶…æ—¶ï¼Œä¾¿äºæ£€æŸ¥åœæ­¢ä¿¡å·
                pcntl_signal_dispatch();
            }
        } catch (\Exception $e) {
            $this-&amp;gt;logger-&amp;gt;info(&quot;Consumer stopped: &quot; . $e-&amp;gt;getMessage());
        }

        $this-&amp;gt;logger-&amp;gt;info(&quot;Consumer stopped gracefully&quot;);
    }

    /**
     * å…³é—­è¿æ¥
     */
    public function close(): void
    {
        try {
            if ($this-&amp;gt;channel &amp;amp;&amp;amp; $this-&amp;gt;channel-&amp;gt;is_open()) {
                $this-&amp;gt;channel-&amp;gt;close();
            }
            if ($this-&amp;gt;connection &amp;amp;&amp;amp; $this-&amp;gt;connection-&amp;gt;isConnected()) {
                $this-&amp;gt;connection-&amp;gt;close();
            }
            if ($this-&amp;gt;redis) {
                $this-&amp;gt;redis-&amp;gt;close();
            }
            $this-&amp;gt;logger-&amp;gt;info(&quot;All connections closed&quot;);
        } catch (\Exception $e) {
            $this-&amp;gt;logger-&amp;gt;error(&quot;Error closing connections: &quot; . $e-&amp;gt;getMessage());
        }
    }

    public function __destruct()
    {
        $this-&amp;gt;close();
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸‰ã€ å…·ä½“ä¸šåŠ¡æ¶ˆè´¹è€… (app/Consumers/OrderCreatedConsumer.php)&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
namespace App\Consumers;

use Psr\Log\LoggerInterface;

class OrderCreatedConsumer extends BaseConsumer
{
    public function __construct(array $config, LoggerInterface $logger)
    {
        parent::__construct($config, $logger);
    }

    /**
     * ä¸šåŠ¡æ¶ˆæ¯å¤„ç†
     */
    protected function processMessage(array $data, array $headers): bool
    {
        try {
            $messageId = $data['message_id'] ?? 'unknown';
            $orderId = $data['order_id'] ?? null;
            $orderData = $data['data'] ?? [];

            if (!$orderId) {
                throw new \Exception(&quot;Missing order_id in message&quot;);
            }

            $this-&amp;gt;logger-&amp;gt;info(&quot;Processing order creation&quot;, [
                'order_id' =&amp;gt; $orderId,
                'message_id' =&amp;gt; $messageId
            ]);

            // æ¨¡æ‹Ÿä¸šåŠ¡å¤„ç†ï¼šåˆ›å»ºè®¢å•ã€æ‰£åº“å­˜ã€å‘é€šçŸ¥ç­‰
            // è¿™é‡Œåº”è¯¥æ˜¯ä½ çš„å®é™…ä¸šåŠ¡é€»è¾‘
            $result = $this-&amp;gt;createOrder($orderId, $orderData);
            
            if (!$result) {
                throw new \Exception(&quot;Order creation failed for order_id: {$orderId}&quot;);
            }

            // æ¨¡æ‹Ÿæ•°æ®åº“äº‹åŠ¡æäº¤
            $this-&amp;gt;commitTransaction();

            return true;

        } catch (\Exception $e) {
            $this-&amp;gt;rollbackTransaction();
            throw $e;
        }
    }

    /**
     * åˆ›å»ºè®¢å•ä¸šåŠ¡é€»è¾‘
     */
    private function createOrder(string $orderId, array $orderData): bool
    {
        // è¿™é‡Œå®ç°ä½ çš„è®¢å•åˆ›å»ºé€»è¾‘
        // ä¾‹å¦‚ï¼šå†™å…¥æ•°æ®åº“ã€è°ƒç”¨åº“å­˜æœåŠ¡ã€å‘é€é€šçŸ¥ç­‰
        
        // æ¨¡æ‹Ÿå¤„ç†æ—¶é—´
        usleep(rand(100000, 500000)); // 0.1-0.5ç§’
        
        // æ¨¡æ‹Ÿå¶å°”çš„å¤±è´¥ï¼ˆç”¨äºæµ‹è¯•é‡è¯•æœºåˆ¶ï¼‰
        if (rand(1, 100) &amp;lt;= 5) { // 5% å¤±è´¥ç‡
            return false;
        }
        
        $this-&amp;gt;logger-&amp;gt;info(&quot;Order created successfully&quot;, ['order_id' =&amp;gt; $orderId]);
        return true;
    }

    /**
     * æäº¤äº‹åŠ¡
     */
    private function commitTransaction(): void
    {
        // å®ç°ä½ çš„äº‹åŠ¡æäº¤é€»è¾‘
        // ä¾‹å¦‚ï¼šDB::commit() æˆ–å…¶ä»–æœåŠ¡çš„ç¡®è®¤
    }

    /**
     * å›æ»šäº‹åŠ¡
     */
    private function rollbackTransaction(): void
    {
        // å®ç°ä½ çš„äº‹åŠ¡å›æ»šé€»è¾‘
        // ä¾‹å¦‚ï¼šDB::rollBack() æˆ–å…¶ä»–æœåŠ¡çš„å–æ¶ˆ
    }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;å››ã€ æ¶ˆè´¹è€…å¯åŠ¨è„šæœ¬ (bin/consumer.php)&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;#!/usr/bin/env php
&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;require_once&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;__DIR__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/../vendor/autoload.php'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;App\Consumers\OrderCreatedConsumer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Monolog\Logger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Monolog\Handler\RotatingFileHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Monolog\Formatter\LineFormatter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// åŠ è½½é…ç½®
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;require_once&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;__DIR__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/../config/rabbitmq.php'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// åˆå§‹åŒ–æ—¥å¿—
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$logger&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Logger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'rabbitmq_consumer'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;// æ–‡ä»¶å¤„ç†å™¨ï¼ˆæŒ‰å¤©è½®è½¬ï¼Œä¿ç•™30å¤©ï¼‰
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fileHandler&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;RotatingFileHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;nx&quot;&gt;__DIR__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/../logs/consumer.log'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// ä¿ç•™å¤©æ•°
&lt;/span&gt;    &lt;span class=&quot;nx&quot;&gt;Logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;::&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;INFO&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$formatter&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;LineFormatter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;[%datetime%] %channel%.%level_name%: %message% %context% %extra%&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;Y-m-d H:i:s.u&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$fileHandler&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;setFormatter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$formatter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;pushHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$fileHandler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;c1&quot;&gt;// åˆ›å»ºæ¶ˆè´¹è€…å®ä¾‹
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$consumer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;OrderCreatedConsumer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$logger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// åˆå§‹åŒ–è¿æ¥
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$consumer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    
    &lt;span class=&quot;c1&quot;&gt;// å¼€å§‹æ¶ˆè´¹ï¼ˆä¼˜é›…å…³é—­æ”¯æŒï¼‰
&lt;/span&gt;    &lt;span class=&quot;nv&quot;&gt;$consumer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;startConsuming&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'order.created'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\Exception&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;nv&quot;&gt;$logger&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;critical&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Consumer failed to start: &quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;s1&quot;&gt;'exception'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$e&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&amp;gt;&lt;/span&gt;&lt;span class=&quot;na&quot;&gt;getTraceAsString&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;]);&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;äº”ã€ Supervisor é…ç½® (supervisor/consumer.conf)&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[program:rabbitmq-order-consumer]
process_name=%(program_name)s_%(process_num)02d
command=/usr/bin/php /path/to/your/project/bin/consumer.php
directory=/path/to/your/project
numprocs=2
autostart=true
autorestart=true
startretries=3
user=www-data
redirect_stderr=true
stdout_logfile=/path/to/your/project/logs/supervisor.log
stopwaitsecs=30
killasgroup=true
priority=999

; ç¯å¢ƒå˜é‡
environment=APP_ENV=&quot;production&quot;,APP_DEBUG=&quot;false&quot;

; åœæ­¢ä¿¡å·ï¼ˆä¼˜é›…å…³é—­ï¼‰
stopsignal=TERM
stopasgroup=true
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;-ä½¿ç”¨æ–¹å¼&quot;&gt;ğŸš€ ä½¿ç”¨æ–¹å¼&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸€ã€ å®‰è£…ä¾èµ–ï¼š&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;composer require php-amqplib/php-amqplib monolog/monolog predis/predis
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;äºŒã€ é…ç½® Supervisorï¼š&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sudo cp supervisor/consumer.conf /etc/supervisor/conf.d/
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start rabbitmq-order-consumer:*
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸‰ã€ ç›‘æ§æ—¥å¿—ï¼š&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;tail -f logs/consumer.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Zhao Q.H.</name></author><category term="é¢è¯•" /><category term="rabbitmq" /><summary type="html">æ¶ˆæ¯é˜Ÿåˆ— ç”Ÿäº§è€…å°†æ¶ˆæ¯å‘å¾€äº¤æ¢æœºï¼Œäº¤æ¢æœºä¾æ®è·¯ç”±è§„åˆ™å’Œç»‘å®šå…³ç³»å°†æ¶ˆæ¯æŠ•é€’åˆ°æŒ‡å®šé˜Ÿåˆ—ï¼›é˜Ÿåˆ—æŒä¹…åŒ–å­˜å‚¨æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç›‘å¬é˜Ÿåˆ—è·å–æ¶ˆæ¯ï¼Œå¤„ç†å®Œæˆåå‘é€ ACKï¼ŒRabbitMQ ç¡®è®¤ååˆ é™¤æ¶ˆæ¯ â€”â€” å½¢æˆä¸€æ¡å®Œæ•´ã€å¯é ã€å¯æ§çš„æ¶ˆæ¯æµè½¬é“¾è·¯ã€‚</summary></entry><entry><title type="html">XHProfæ€§èƒ½åˆ†æå·¥å…·ã€‚</title><link href="http://localhost:4000/php/2025/12/03/xhprof/" rel="alternate" type="text/html" title="XHProfæ€§èƒ½åˆ†æå·¥å…·ã€‚" /><published>2025-12-03T00:00:00+08:00</published><updated>2025-12-03T00:00:00+08:00</updated><id>http://localhost:4000/php/2025/12/03/xhprof</id><content type="html" xml:base="http://localhost:4000/php/2025/12/03/xhprof/">&lt;p&gt;XHProf æœ€åˆç”± Facebook å¼€æºï¼Œæ›¾æ˜¯ PHP æ€§èƒ½åˆ†æçš„æ ‡æ†å·¥å…·ï¼›å¦‚ä»Šåœ¨ç¤¾åŒºçš„æŒç»­ç»´æŠ¤ä¸‹ï¼Œå·²å®ç°å¯¹ PHP 8.4 çš„å®Œæ•´æ”¯æŒï¼Œå‡­å€Ÿå…¶ä½å¼€é”€é‡‡æ ·ã€å¤šç»´åº¦æŒ‡æ ‡é‡‡é›†ï¼ˆæ—¶é—´ã€å†…å­˜ã€è°ƒç”¨æ ˆï¼‰å’Œå¯è§†åŒ–è°ƒç”¨å›¾èƒ½åŠ›ï¼Œä¾ç„¶æ˜¯ PHP å¼€å‘è€…åœ¨å¼€å‘è°ƒè¯•ä¸ç”Ÿäº§è¯Šæ–­ä¸­è¿›è¡Œæ€§èƒ½ç“¶é¢ˆå®šä½çš„é«˜æ•ˆåˆ©å™¨ã€‚&lt;/p&gt;

&lt;h2 id=&quot;xhprof2310æŠ¥å‘Šè¡¨å¤´&quot;&gt;XHProf2.3.10æŠ¥å‘Šè¡¨å¤´&lt;/h2&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;è‹±æ–‡è¡¨å¤´&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;ä¸­æ–‡è§£é‡Š&lt;/th&gt;
      &lt;th style=&quot;text-align: left&quot;&gt;è¯¦ç»†è¯´æ˜ä¸é‡è¦æ€§&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Function Name&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;å‡½æ•°åç§°&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;è¢«è°ƒç”¨çš„å‡½æ•°æˆ–æ–¹æ³•çš„å®Œæ•´åç§°ã€‚ä¾‹å¦‚ &lt;code class=&quot;highlighter-rouge&quot;&gt;main()&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;mysql_query&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;UserController::index()&lt;/code&gt;ã€‚è¿™æ˜¯è¯†åˆ«ä»£ç ä½ç½®çš„å…³é”®ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Calls&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;è°ƒç”¨æ¬¡æ•°&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;è¯¥å‡½æ•°åœ¨æ­¤æ¬¡è¯·æ±‚ä¸­è¢«è°ƒç”¨çš„æ€»æ¬¡æ•°ã€‚&lt;br /&gt;&lt;strong&gt;é‡è¦æ€§&lt;/strong&gt;ï¼šå¦‚æœä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨äº†æˆåƒä¸Šä¸‡æ¬¡ï¼ˆä¾‹å¦‚å¾ªç¯å†…ï¼‰ï¼Œå³ä½¿å•æ¬¡å¾ˆå¿«ï¼Œç´¯ç§¯èµ·æ¥ä¹Ÿå¯èƒ½æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Calls%&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;è°ƒç”¨æ¬¡æ•°å æ¯”&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;è¯¥å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°å æ€»è°ƒç”¨æ¬¡æ•°çš„ç™¾åˆ†æ¯”ã€‚&lt;br /&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šå¸®åŠ©è¯†åˆ«å“ªäº›å‡½æ•°æ˜¯ç¨‹åºçš„ä¸»è¦æ‰§è¡Œè·¯å¾„ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Incl. Wall Time (microsec)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;æ€»è€—æ—¶ (å¾®ç§’)&lt;/strong&gt; &lt;br /&gt;&lt;em&gt;(æˆ–: åŒ…å«å®é™…æ—¶é—´)&lt;/em&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;æ ¸å¿ƒæŒ‡æ ‡&lt;/strong&gt;ã€‚æŒ‡å‡½æ•°ä»å¼€å§‹åˆ°ç»“æŸçš„æ€»è€—æ—¶ï¼Œ&lt;strong&gt;åŒ…æ‹¬å…¶å†…éƒ¨è°ƒç”¨çš„æ‰€æœ‰å­å‡½æ•°çš„æ—¶é—´&lt;/strong&gt;ã€‚&lt;br /&gt;å•ä½ï¼šå¾®ç§’ (1ç§’ = 1,000,000 å¾®ç§’)ã€‚&lt;br /&gt;&lt;strong&gt;é‡è¦æ€§&lt;/strong&gt;ï¼šç”¨äºå®šä½å“ªä¸ªå¤§çš„åŠŸèƒ½æ¨¡å—æœ€è€—æ—¶ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;IWall%&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;æ€»è€—æ—¶å æ¯”&lt;/strong&gt; &lt;br /&gt;&lt;em&gt;(æˆ–: åŒ…å«å®é™…æ—¶é—´å æ¯”)&lt;/em&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;è¯¥å‡½æ•°çš„åŒ…å«æ—¶é—´å æ€»åŒ…å«æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚&lt;br /&gt;&lt;strong&gt;é‡è¦æ€§&lt;/strong&gt;ï¼šç›´è§‚åœ°çœ‹å‡ºæ¯ä¸ªå‡½æ•°å¯¹æ€»å“åº”æ—¶é—´çš„â€œè´¡çŒ®â€æ¯”ä¾‹ã€‚&lt;code class=&quot;highlighter-rouge&quot;&gt;main()&lt;/code&gt; å‡½æ•°æ°¸è¿œæ˜¯ 100%ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Excl. Wall Time (microsec)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;è‡ªèº«è€—æ—¶ (å¾®ç§’)&lt;/strong&gt; &lt;br /&gt;&lt;em&gt;(æˆ–: ç‹¬å å®é™…æ—¶é—´)&lt;/em&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;å¦ä¸€ä¸ªæ ¸å¿ƒæŒ‡æ ‡&lt;/strong&gt;ã€‚æŒ‡å‡½æ•°è‡ªèº«çš„æ‰§è¡Œæ—¶é—´ï¼Œ&lt;strong&gt;ä¸åŒ…æ‹¬å…¶å†…éƒ¨è°ƒç”¨çš„ä»»ä½•å­å‡½æ•°çš„æ—¶é—´&lt;/strong&gt;ã€‚&lt;br /&gt;&lt;strong&gt;é‡è¦æ€§&lt;/strong&gt;ï¼šè¿™æ˜¯&lt;strong&gt;ä¼˜åŒ–çš„å…³é”®&lt;/strong&gt;ï¼å¦‚æœè¿™ä¸ªå€¼å¾ˆé«˜ï¼Œè¯´æ˜å‡½æ•°è‡ªèº«çš„é€»è¾‘ï¼ˆç®—æ³•ã€å¾ªç¯ã€è®¡ç®—ï¼‰éœ€è¦ä¼˜åŒ–ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;EWall%&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;è‡ªèº«è€—æ—¶å æ¯”&lt;/strong&gt; &lt;br /&gt;&lt;em&gt;(æˆ–: ç‹¬å å®é™…æ—¶é—´å æ¯”)&lt;/em&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;è¯¥å‡½æ•°çš„ç‹¬å æ—¶é—´å æ€»æ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚&lt;br /&gt;&lt;strong&gt;ç”¨é€”&lt;/strong&gt;ï¼šè¾…åŠ©åˆ¤æ–­å‡½æ•°è‡ªèº«é€»è¾‘çš„è€—æ—¶å æ¯”ã€‚ä½†é€šå¸¸æˆ‘ä»¬æ›´å…³æ³¨ç»å¯¹å€¼ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Incl. CPU (microsecs)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;æ€»CPUæ—¶é—´ (å¾®ç§’)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ç±»ä¼¼äº &lt;code class=&quot;highlighter-rouge&quot;&gt;æ€»è€—æ—¶&lt;/code&gt;ï¼Œä½†æ˜¯ç»Ÿè®¡çš„æ˜¯CPUå®é™…å·¥ä½œçš„æ—¶é—´ï¼Œæ’é™¤äº†ç­‰å¾…æ—¶é—´ï¼ˆå¦‚I/Oã€ç½‘ç»œã€sleepï¼‰ã€‚&lt;br /&gt;&lt;strong&gt;é‡è¦æ€§&lt;/strong&gt;ï¼šå¦‚æœ &lt;code class=&quot;highlighter-rouge&quot;&gt;æ€»è€—æ—¶&lt;/code&gt; å¾ˆé«˜ä½† &lt;code class=&quot;highlighter-rouge&quot;&gt;æ€»CPUæ—¶é—´&lt;/code&gt; å¾ˆä½ï¼Œè¯´æ˜ç“¶é¢ˆå¯èƒ½åœ¨I/Oæˆ–å¤–éƒ¨æœåŠ¡ï¼ˆæ•°æ®åº“ã€APIè°ƒç”¨ï¼‰ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Excl. CPU (microsecs)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;è‡ªèº«CPUæ—¶é—´ (å¾®ç§’)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;ç±»ä¼¼äº &lt;code class=&quot;highlighter-rouge&quot;&gt;è‡ªèº«è€—æ—¶&lt;/code&gt;ï¼Œæ˜¯å‡½æ•°è‡ªèº«æ¶ˆè€—çš„çº¯CPUæ—¶é—´ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Incl. MemUse (bytes)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;åŒ…å«å†…å­˜å ç”¨ (å­—èŠ‚)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†é…çš„å†…å­˜æ€»é‡ï¼ŒåŒ…æ‹¬å…¶å­å‡½æ•°åˆ†é…çš„å†…å­˜ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Excl. MemUse (bytes)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;ç‹¬å å†…å­˜å ç”¨ (å­—èŠ‚)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;å‡½æ•°è‡ªèº«ç›´æ¥åˆ†é…çš„å†…å­˜é‡ï¼Œä¸åŒ…æ‹¬å­å‡½æ•°ã€‚&lt;br /&gt;&lt;strong&gt;é‡è¦æ€§&lt;/strong&gt;ï¼šç”¨äºå‘ç°å†…å­˜æ³„æ¼æˆ–å¤§å¯¹è±¡åˆ†é…çš„çƒ­ç‚¹ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Incl. PeakMemUse (bytes)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;åŒ…å«å³°å€¼å†…å­˜ (å­—èŠ‚)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;åœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´ï¼Œæ•´ä¸ªè¿›ç¨‹è¾¾åˆ°çš„å†…å­˜ä½¿ç”¨å³°å€¼ï¼ŒåŒ…æ‹¬å­å‡½æ•°çš„å½±å“ã€‚&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;Excl. PeakMemUse (bytes)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;&lt;strong&gt;ç‹¬å å³°å€¼å†…å­˜ (å­—èŠ‚)&lt;/strong&gt;&lt;/td&gt;
      &lt;td style=&quot;text-align: left&quot;&gt;åœ¨å‡½æ•°è‡ªèº«æ‰§è¡Œæ ˆå¸§å†…è¾¾åˆ°çš„å†…å­˜å³°å€¼ã€‚&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;xhprofæ‰©å±•åœ°å€&quot;&gt;xhprofæ‰©å±•åœ°å€&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://pecl.php.net/package/xhprof&quot;&gt;https://pecl.php.net/package/xhprof&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;xhprofä»£ç åœ°å€&quot;&gt;xhprofä»£ç åœ°å€&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/longxinH/xhprof&quot;&gt;https://github.com/longxinH/xhprof&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;xhprofä½¿ç”¨ä¾‹å­&quot;&gt;xhprofä½¿ç”¨ä¾‹å­&lt;/h2&gt;
&lt;h3 id=&quot;ä»£ç &quot;&gt;ä»£ç &lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;?php
xhprof_enable(XHPROF_FLAGS_CPU + XHPROF_FLAGS_MEMORY);

for ($i = 0; $i &amp;lt;= 1000; $i++) {
    $a = $i * $i;
}

$xhprof_data = xhprof_disable();

$XHPROF_ROOT = &quot;/tools/xhprof/&quot;;
include_once $XHPROF_ROOT . &quot;/xhprof_lib/utils/xhprof_lib.php&quot;;
include_once $XHPROF_ROOT . &quot;/xhprof_lib/utils/xhprof_runs.php&quot;;

$xhprof_runs = new XHProfRuns_Default();
$run_id = $xhprof_runs-&amp;gt;save_run($xhprof_data, &quot;xhprof_testing&quot;);

echo &quot;http://localhost/xhprof/xhprof_html/index.php?run={$run_id}&amp;amp;source=xhprof_testing\n&quot;;

?&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;è¾“å‡ºæŠ¥å‘Šé“¾æ¥&quot;&gt;è¾“å‡ºæŠ¥å‘Šé“¾æ¥&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;http://localhost/xhprof/xhprof_html/index.php?run=t11_4bdf44d21121f&amp;amp;source=xhprof_testing
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;æŠ¥å‘Šè¡¨ä¾‹å­&quot;&gt;æŠ¥å‘Šè¡¨ä¾‹å­&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/php/xhprof-1.png&quot; /&gt;
&lt;img src=&quot;/assets/images/php/xhprof-2.png&quot; /&gt;&lt;/p&gt;</content><author><name>Zhao Q.H.</name></author><category term="php" /><category term="xhprof" /><summary type="html">XHProf æœ€åˆç”± Facebook å¼€æºï¼Œæ›¾æ˜¯ PHP æ€§èƒ½åˆ†æçš„æ ‡æ†å·¥å…·ï¼›å¦‚ä»Šåœ¨ç¤¾åŒºçš„æŒç»­ç»´æŠ¤ä¸‹ï¼Œå·²å®ç°å¯¹ PHP 8.4 çš„å®Œæ•´æ”¯æŒï¼Œå‡­å€Ÿå…¶ä½å¼€é”€é‡‡æ ·ã€å¤šç»´åº¦æŒ‡æ ‡é‡‡é›†ï¼ˆæ—¶é—´ã€å†…å­˜ã€è°ƒç”¨æ ˆï¼‰å’Œå¯è§†åŒ–è°ƒç”¨å›¾èƒ½åŠ›ï¼Œä¾ç„¶æ˜¯ PHP å¼€å‘è€…åœ¨å¼€å‘è°ƒè¯•ä¸ç”Ÿäº§è¯Šæ–­ä¸­è¿›è¡Œæ€§èƒ½ç“¶é¢ˆå®šä½çš„é«˜æ•ˆåˆ©å™¨ã€‚</summary></entry><entry><title type="html">docker å®¹å™¨åŒ–æ„å»ºphp-laravelå¼€å‘ç¯å¢ƒ</title><link href="http://localhost:4000/php/2025/11/30/php-larvel/" rel="alternate" type="text/html" title="docker å®¹å™¨åŒ–æ„å»ºphp-laravelå¼€å‘ç¯å¢ƒ" /><published>2025-11-30T00:00:00+08:00</published><updated>2025-11-30T00:00:00+08:00</updated><id>http://localhost:4000/php/2025/11/30/php-larvel</id><content type="html" xml:base="http://localhost:4000/php/2025/11/30/php-larvel/">&lt;h2 id=&quot;æ„å»ºphp-laravel84151-fpm-xdebugé•œåƒ&quot;&gt;æ„å»ºphp-laravel:8.4.15.1-fpm-xdebugé•œåƒ&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨php8.4.15-fpmé•œåƒä½œä¸ºåŸºç¡€é•œåƒæ„å»º8.4.15.1-fpm-xdebugé•œåƒã€‚&lt;/p&gt;
&lt;h2 id=&quot;laravel&quot;&gt;laravel&lt;/h2&gt;
&lt;p&gt;laravelç‰ˆæœ¬æ˜¯12&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@bcb209344039:/app/app# php artisan -V
Laravel Framework 12.39.0
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;php&quot;&gt;php&lt;/h2&gt;
&lt;p&gt;ä½¿ç”¨&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@bcb209344039:/app/app# php --version
PHP 8.4.15 (cli) (built: Nov 20 2025 19:53:54) (NTS)
Copyright (c) The PHP Group
Built by https://github.com/docker-library/php
Zend Engine v4.4.15, Copyright (c) Zend Technologies
    with Zend OPcache v8.4.15, Copyright (c), by Zend Technologies
    with Xdebug v3.4.7, Copyright (c) 2002-2025, by Derick Rethans
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;docker-compose&quot;&gt;docker-compose&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;services:
  laravel-svc:
    container_name: laravel-ctr
    build: ./build/
    command: sh -c &quot;cd /app/app &amp;amp;&amp;amp; npm install &amp;amp;&amp;amp; npm run build &amp;amp;&amp;amp;
            composer run dev&quot;
    image: php-laravel:8.4.15.1-fpm-xdebug
    restart: always
    ports:
      - 8000:8000
    volumes:
      - ./app/app:/app/app
      - ./build/etc/docker-php-ext-xdebug.ini:/usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini 
    networks:
      - laravel_network
    environment:
      PWD: /app/app
      PHP_PORT: 8000
      DB_CONNECTION: mysql
      DB_HOST: laravel-db-svc
      DB_PORT: 3306
      DB_DATABASE: laravel_db
      DB_USERNAME: zhaoqhu
      DB_PASSWORD: larH2025,.
    # command: [&quot;php&quot;, &quot;-S&quot;, &quot;0.0.0.0:8000&quot;, &quot;-t&quot;, &quot;/var/www/html&quot;]
  laravel-db-svc:
    container_name: laravel-db-ctr
    image: mysql:8.0
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: larH20025,.
      MYSQL_DATABASE: laravel_db
      MYSQL_USER: zhaoqhu
      MYSQL_PASSWORD: larH2025,.
    ports:
      - 3206:3306
    volumes:
      - ./db:/var/lib/mysql
    networks:
      - laravel_network
volumes:
  html:
  db:
networks:
  laravel_network:
    driver: bridge

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;è¿è¡Œæ•ˆæœ&quot;&gt;è¿è¡Œæ•ˆæœ&lt;/h2&gt;
&lt;p&gt;&lt;img src=&quot;/assets/images/php/laravel-12.png&quot; /&gt;
&lt;img src=&quot;/assets/images/php/laravel-debug.png&quot; /&gt;&lt;/p&gt;</content><author><name>Zhao Q.H.</name></author><category term="php" /><category term="laravel" /><summary type="html">æ„å»ºphp-laravel:8.4.15.1-fpm-xdebugé•œåƒ ä½¿ç”¨php8.4.15-fpmé•œåƒä½œä¸ºåŸºç¡€é•œåƒæ„å»º8.4.15.1-fpm-xdebugé•œåƒã€‚ laravel laravelç‰ˆæœ¬æ˜¯12 root@bcb209344039:/app/app# php artisan -V Laravel Framework 12.39.0 php ä½¿ç”¨ root@bcb209344039:/app/app# php --version PHP 8.4.15 (cli) (built: Nov 20 2025 19:53:54) (NTS) Copyright (c) The PHP Group Built by https://github.com/docker-library/php Zend Engine v4.4.15, Copyright (c) Zend Technologies with Zend OPcache v8.4.15, Copyright (c), by Zend Technologies with Xdebug v3.4.7, Copyright (c) 2002-2025, by Derick Rethans</summary></entry><entry><title type="html">Bj</title><link href="http://localhost:4000/2025/11/05/bj/" rel="alternate" type="text/html" title="Bj" /><published>2025-11-05T00:00:00+08:00</published><updated>2025-11-05T00:00:00+08:00</updated><id>http://localhost:4000/2025/11/05/bj</id><content type="html" xml:base="http://localhost:4000/2025/11/05/bj/">&lt;h1 id=&quot;ä¸œåŸ&quot;&gt;ä¸œåŸ&lt;/h1&gt;
&lt;h1 id=&quot;è¥¿åŸ&quot;&gt;è¥¿åŸ&lt;/h1&gt;
&lt;h1 id=&quot;æœé˜³&quot;&gt;æœé˜³&lt;/h1&gt;
&lt;h1 id=&quot;ä¸°å°&quot;&gt;ä¸°å°&lt;/h1&gt;
&lt;h1 id=&quot;æµ·æ·€&quot;&gt;æµ·æ·€&lt;/h1&gt;

&lt;p&gt;https://www.zhipin.com/web/geek/jobs?city=101010100&amp;amp;multiBusinessDistrict=110101,110102,110105,110106,110108&amp;amp;query=php&lt;/p&gt;

&lt;p&gt;https://www.zhipin.com/web/geek/jobs?city=101010100&amp;amp;multiBusinessDistrict=110101,110102,110105,110106,110108&amp;amp;query=php%20golang&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -X POST &quot;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&quot; \
-H &quot;Authorization: Bearer sk-4a93b67d823047df8121c9093e2fb1d0&quot; \
-H &quot;Content-Type: application/json&quot; \
--no-buffer \
-d '{
    &quot;model&quot;: &quot;qwen-plus&quot;,
    &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä½ æ˜¯è°ï¼Ÿ&quot;}],
    &quot;stream&quot;: true,
    &quot;stream_options&quot;: {&quot;include_usage&quot;: true}
}'

curl -X POST &quot;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&quot; \
-H &quot;Authorization: Bearer sk-4a93b67d823047df8121c9093e2fb1d0&quot; \
-H &quot;Content-Type: application/json&quot; \
--no-buffer \
-d '{
    &quot;model&quot;: &quot;qwen-plus&quot;,
    &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;ä½ æ˜¯è°ï¼Ÿ&quot;}]
}'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;curl -X POST &quot;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&quot; \
-H &quot;Authorization: Bearer sk-4a93b67d823047df8121c9093e2fb1d0&quot; \
-H &quot;Content-Type: application/json&quot; \
--no-buffer \
-d '{
    &quot;model&quot;: &quot;qwen-plus&quot;,
    &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;phpåœ¨è°ƒç”¨é˜¿é‡Œäº‘å¤§æ¨¡å‹é˜¿é‡Œç™¾ç‚¼æ€ä¹ˆåšåˆ°æµå¼è¾“å‡ºã€‚&quot;}],
    &quot;stream&quot;: true,
    &quot;stream_options&quot;: {&quot;include_usage&quot;: true}
}'

curl -X POST &quot;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&quot; \
-H &quot;Authorization: Bearer sk-4a93b67d823047df8121c9093e2fb1d0&quot; \
-H &quot;Content-Type: application/json&quot; \
--no-buffer \
-d '{
    &quot;model&quot;: &quot;qwen-plus&quot;,
    &quot;messages&quot;: [{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;phpåœ¨è°ƒç”¨é˜¿é‡Œäº‘å¤§æ¨¡å‹é˜¿é‡Œç™¾ç‚¼æ€ä¹ˆåšåˆ°æµå¼è¾“å‡ºã€‚&quot;}]
}'
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;</content><author><name>Zhao Q.H.</name></author><summary type="html">ä¸œåŸ è¥¿åŸ æœé˜³ ä¸°å° æµ·æ·€</summary></entry><entry><title type="html">Wuqing</title><link href="http://localhost:4000/2025/11/04/wuqing/" rel="alternate" type="text/html" title="Wuqing" /><published>2025-11-04T00:00:00+08:00</published><updated>2025-11-04T00:00:00+08:00</updated><id>http://localhost:4000/2025/11/04/wuqing</id><content type="html" xml:base="http://localhost:4000/2025/11/04/wuqing/">&lt;h1 id=&quot;æ­¦æ¸…å•†åœˆ&quot;&gt;æ­¦æ¸…å•†åœˆ&lt;/h1&gt;
&lt;h2 id=&quot;ä½›ç½—ä¼¦è¨å°é•‡&quot;&gt;ä½›ç½—ä¼¦è¨å°é•‡&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=ä½›ç½—ä¼¦è¨å°é•‡&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;åˆ›æ„ç±³å…°ç”Ÿæ´»å¹¿åœº&quot;&gt;åˆ›æ„ç±³å…°ç”Ÿæ´»å¹¿åœº&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=åˆ›æ„ç±³å…°ç”Ÿæ´»å¹¿åœº&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;v1æ±½è½¦ä¸–ç•Œ&quot;&gt;V1æ±½è½¦ä¸–ç•Œ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=V1æ±½è½¦ä¸–ç•Œ&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;å¨å°¼éƒ½&quot;&gt;å¨å°¼éƒ½&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=å¨å°¼éƒ½&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç¦æºä¸‡è¾¾å¹¿åœº&quot;&gt;ç¦æºä¸‡è¾¾å¹¿åœº&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=ç¦æºä¸‡è¾¾å¹¿åœº&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ä½æ€»å¤§å…‰æ˜ä¸­å¿ƒ&quot;&gt;ä½æ€»å¤§å…‰æ˜ä¸­å¿ƒ&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=ä½æ€»å¤§å…‰æ˜ä¸­å¿ƒ&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;å‹è°Šå•†å¦&quot;&gt;å‹è°Šå•†å¦&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=å‹è°Šå•†å¦&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;è”éš†æ—¶ä»£å¹¿åœºè”éš†å¹¿åœº&quot;&gt;è”éš†æ—¶ä»£å¹¿åœº/è”éš†å¹¿åœº&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=è”éš†æ—¶ä»£å¹¿åœº/è”éš†å¹¿åœº&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç‘å®‰å¨å°¼éƒ½&quot;&gt;ç‘å®‰å¨å°¼éƒ½&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://www.zhipin.com/web/geek/jobs?city=101030100&amp;amp;multiBusinessDistrict=120114&amp;amp;query=ç‘å®‰å¨å°¼éƒ½&quot; target=&quot;_blank&quot;&gt;Bossç›´è˜&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Zhao Q.H.</name></author><summary type="html">æ­¦æ¸…å•†åœˆ ä½›ç½—ä¼¦è¨å°é•‡</summary></entry><entry><title type="html">Hugging face å­¦ä¹ è®°å½•</title><link href="http://localhost:4000/2025/10/21/huggingface/" rel="alternate" type="text/html" title="Hugging face å­¦ä¹ è®°å½•" /><published>2025-10-21T00:00:00+08:00</published><updated>2025-10-21T00:00:00+08:00</updated><id>http://localhost:4000/2025/10/21/huggingface</id><content type="html" xml:base="http://localhost:4000/2025/10/21/huggingface/">&lt;h1 id=&quot;hugging-face&quot;&gt;Hugging face&lt;/h1&gt;

&lt;ul&gt;
  &lt;li&gt;hugging faceå…¥é—¨æ•™ç¨‹ï¼Œå¯ä»¥åœ¨è‡ªå·±çš„macbook pro 15æ¬¾ä¸Šå­¦ä¹ å’Œç»ƒä¹ huggging faceå—ï¼Ÿ&lt;/li&gt;
  &lt;li&gt;æˆ‘çš„macbook pro 15æ¬¾8+256Gçš„æœ‰dockerç¯å¢ƒï¼Œç¬¬ä¸€éƒ¨åˆ†Huggingfaceçš„Pythonç¯å¢ƒå¯ä»¥ç”¨dockerçš„pythonç¯å¢ƒå—ï¼Ÿ&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;ç¯å¢ƒå‡†å¤‡&quot;&gt;ç¯å¢ƒå‡†å¤‡&lt;/h2&gt;
&lt;h3 id=&quot;å®‰è£…python-39&quot;&gt;å®‰è£…Python 3.9&lt;/h3&gt;
&lt;h3 id=&quot;pipå®‰è£…pytorch&quot;&gt;Pipå®‰è£…PyTorch&lt;/h3&gt;
&lt;h3 id=&quot;pipå®‰è£…hugging-faceæ ¸å¿ƒåº“transformerå’Œdatasets&quot;&gt;Pipå®‰è£…Hugging Faceæ ¸å¿ƒåº“transformerå’Œdatasets&lt;/h3&gt;</content><author><name>Zhao Q.H.</name></author><summary type="html">Hugging face</summary></entry><entry><title type="html">mysqlé¢è¯•æ±‡æ€»</title><link href="http://localhost:4000/%E9%9D%A2%E8%AF%95/2025/10/11/mysql-ms/" rel="alternate" type="text/html" title="mysqlé¢è¯•æ±‡æ€»" /><published>2025-10-11T00:00:00+08:00</published><updated>2025-10-11T00:00:00+08:00</updated><id>http://localhost:4000/%E9%9D%A2%E8%AF%95/2025/10/11/mysql-ms</id><content type="html" xml:base="http://localhost:4000/%E9%9D%A2%E8%AF%95/2025/10/11/mysql-ms/">&lt;h2 id=&quot;mysql&quot;&gt;MySQL&lt;/h2&gt;

&lt;h3 id=&quot;mysqlç´¢å¼•ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•&quot;&gt;Mysqlç´¢å¼•ç”¨çš„æ˜¯ä»€ä¹ˆç®—æ³•&lt;/h3&gt;

&lt;p&gt;Mysqlé€‰ç”¨çš„æ˜¯B+æ ‘ï¼ŒB+æ ‘ä¸»è¦æ˜¯æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(logmN)ï¼Œå†…éƒ¨èŠ‚ç‚¹å¯ä»¥æ‹¥æœ‰å¤šä¸ªå­èŠ‚ç‚¹ï¼Œé€šå¸¸å¤§äº2ï¼Œè¿™ä½¿å¾—B+æ ‘æ¯”äºŒå‰æ ‘æ›´å®½ï¼Œæ›´çŸ®æ—¶é—´å¤æ‚åº¦æ˜¯O(log2N)æœ‰åŠ©äºå‡å°‘æ ‘çš„é«˜åº¦ï¼Œè¿›è€Œå‡å°‘ç£ç›˜I/Oæ“ä½œã€‚
æ€»ç»“ï¼šMysqlä¸­åˆ›å»ºç´¢å¼•çš„ç›®çš„æ˜¯ä¸ºäº†æ›´å¿«çš„æŸ¥è¯¢ï¼Œç´¢å¼•é€‰ç”¨B+æ ‘çš„æ•°æ®ç»“æ„ï¼Œè¿™ç§ç»“æ„çš„æŸ¥æ‰¾ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯O(logmN)ï¼ŒæŸ¥æ‰¾çš„æ•ˆç‡å¿«ï¼Œç£ç›˜I/Oæ“ä½œå°‘ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqläº‹åŠ¡çš„å…³é”®ç‰¹æ€§&quot;&gt;MySQLäº‹åŠ¡çš„å…³é”®ç‰¹æ€§&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;åŸå­æ€§&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;äº‹åŠ¡æ˜¯æ“ä½œçš„æœ€å°å•å…ƒï¼Œè¦ä¹ˆå…¨æˆåŠŸï¼Œè¦ä¹ˆå…¨å›æ»šã€‚
åŸå­æ€§æ˜¯æŒ‡å¼€å¯äº‹åŠ¡åæ•°æ®åº“çš„ä¿®æ”¹æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼Œå›æ»šåˆ°äº‹åŠ¡ä¹‹å‰çš„çŠ¶æ€ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸€è‡´æ€§&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;äº‹åŠ¡æ‰§è¡Œå‰åï¼Œæ•°æ®åº“ä»ä¸€ä¸ªåˆæ³•çŠ¶æ€å˜ä¸ºå¦ä¸€ä¸ªåˆæ³•çŠ¶æ€ï¼ˆå¦‚è½¬è´¦æ€»é‡‘é¢ä¸å˜ï¼‰ã€‚&lt;/p&gt;

&lt;p&gt;ä¸€è‡´æ€§æ˜¯æŒ‡éµå®ˆèµ„é‡‘å®ˆæ’åŸåˆ™ï¼Œä¾‹å¦‚é“¶è¡Œè½¬è´¦æ“ä½œAè´¦æˆ·è½¬å‡ºä¸€å®šçš„é‡‘é¢ç»™Bè´¦æˆ·ï¼Œä¸ºäº†å¾—åˆ°ä¸€è‡´æ€§è¿™ä¸ªäº‹åŠ¡éœ€è¦ç¡®ä¿é‡‘é¢ä»Aå‡å°‘å¹¶åœ¨å¢åŠ ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;éš”ç¦»æ€§&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å¤šäº‹åŠ¡å¹¶å‘æ—¶äº’ä¸å¹²æ‰°ï¼Œé»˜è®¤éš”ç¦»çº§åˆ«REPEATABLE READé€šè¿‡MVCCå’Œé—´éš™é”é¿å…è„è¯»ã€ä¸å¯é‡å¤è¯»ã€éƒ¨åˆ†å¹»è¯»
éš”ç¦»æ€§ï¼Œåœ¨å¹¶å‘äº‹åŠ¡T1å’ŒT2éƒ½éœ€è¦æ›´æ–°åŒä¸€ä¸ªè´¦æˆ·çš„ä½™é¢ï¼Œè‹¥æ²¡æœ‰éš”ç¦»æªæ–½ï¼ŒT1å’ŒT2å¯èƒ½ä¼šä½¿ç”¨åŒæ ·çš„é‡‘é¢è¿›è¡Œè®¡ç®—ï¼Œä»è€Œå¯¼è‡´ç»“æœé”™è¯¯ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;æŒä¹…æ€§&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;mysqläº‹åŠ¡æäº¤åæ°¸ä¹…ä¿å­˜ï¼Œå®•æœºä¸ä¸¢å¤±ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlä¸­é”&quot;&gt;Mysqlä¸­é”&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;é”ç±»å‹&lt;/th&gt;
      &lt;th&gt;è§¦å‘æ–¹å¼&lt;/th&gt;
      &lt;th&gt;ä½œç”¨èŒƒå›´&lt;/th&gt;
      &lt;th&gt;å…¼å®¹æ€§&lt;/th&gt;
      &lt;th&gt;ä½¿ç”¨åœºæ™¯&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;è®°å½•é”ï¼ˆRecord Lockï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;éšå¼ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;UPDATE&lt;/code&gt;ã€&lt;code class=&quot;highlighter-rouge&quot;&gt;DELETE&lt;/code&gt; è‡ªåŠ¨åŠ é”&lt;br /&gt;æ˜¾å¼ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;SELECT ... FOR UPDATE&lt;/code&gt; ç²¾ç¡®åŒ¹é…å”¯ä¸€ç´¢å¼•&lt;/td&gt;
      &lt;td&gt;ç´¢å¼•ä¸­çš„æŸä¸€è¡Œè®°å½•&lt;/td&gt;
      &lt;td&gt;ä¸ X é”äº’æ–¥ï¼Œä¸ S é”äº’æ–¥&lt;/td&gt;
      &lt;td&gt;ç²¾ç¡®ä¿®æ”¹/åˆ é™¤å•è¡Œæ•°æ®ï¼Œå¦‚åº“å­˜æ‰£å‡ã€è´¦æˆ·ä½™é¢æ›´æ–°&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;é—´éš™é”ï¼ˆGap Lockï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;éšå¼ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;UPDATE&lt;/code&gt;ã€&lt;code class=&quot;highlighter-rouge&quot;&gt;DELETE&lt;/code&gt;ã€&lt;code class=&quot;highlighter-rouge&quot;&gt;SELECT ... FOR UPDATE/FOR SHARE&lt;/code&gt; åœ¨ &lt;strong&gt;REPEATABLE READ&lt;/strong&gt; ä¸‹æ‰§è¡ŒèŒƒå›´æŸ¥è¯¢ï¼ˆéå”¯ä¸€ç´¢å¼•æˆ–èŒƒå›´æ¡ä»¶ï¼‰&lt;/td&gt;
      &lt;td&gt;ç´¢å¼•è®°å½•ä¹‹é—´çš„é—´éš™ï¼ˆä¸å«è®°å½•æœ¬èº«ï¼‰&lt;/td&gt;
      &lt;td&gt;é˜»æ­¢å…¶ä»–äº‹åŠ¡åœ¨é—´éš™æ’å…¥æ–°è¡Œï¼›S/X é”å‡äº’æ–¥æ’å…¥&lt;/td&gt;
      &lt;td&gt;é˜²æ­¢å¹»è¯»ï¼ˆå†™æ—¶ï¼‰ï¼Œå¦‚é”å®šæŸä»·æ ¼åŒºé—´ä¸å…è®¸æ–°å¢å•†å“&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;éšå¼ï¼šInnoDB åœ¨ &lt;strong&gt;REPEATABLE READ&lt;/strong&gt; ä¸‹é»˜è®¤å¯¹èŒƒå›´æŸ¥è¯¢åŠ é”ï¼ˆè®°å½•é”+é—´éš™é”ï¼‰&lt;/td&gt;
      &lt;td&gt;å·¦å¼€å³é—­åŒºé—´ï¼Œå¦‚ (10, 20]&lt;/td&gt;
      &lt;td&gt;é˜»æ­¢æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤åŒºé—´å†…æ•°æ®&lt;/td&gt;
      &lt;td&gt;RR çº§åˆ«é»˜è®¤é˜²å¹»è¯»æœºåˆ¶ï¼Œæ— éœ€æ‰‹åŠ¨æ§åˆ¶&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;å…±äº«é”ï¼ˆS é”ï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ˜¾å¼ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;SELECT ... FOR SHARE&lt;/code&gt;ï¼ˆMySQL 8.0+ï¼‰&lt;br /&gt;æ˜¾å¼ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;SELECT ... LOCK IN SHARE MODE&lt;/code&gt;ï¼ˆæ—§è¯­æ³•ï¼‰&lt;/td&gt;
      &lt;td&gt;åŠ åœ¨ç´¢å¼•è®°å½•ä¸Š&lt;/td&gt;
      &lt;td&gt;å¤šä¸ª S é”ç›¸å®¹ï¼Œä¸ X é”äº’æ–¥&lt;/td&gt;
      &lt;td&gt;è¯»å¤šå†™å°‘åœºæ™¯ï¼Œå…è®¸å¤šäº‹åŠ¡åŒæ—¶è¯»ä½†é˜»æ­¢ä¿®æ”¹ï¼Œå¦‚è¯»å–é…ç½®è¡¨ã€åŸºç¡€å­—å…¸æ•°æ®&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;æ’ä»–é”ï¼ˆX é”ï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;æ˜¾å¼ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;SELECT ... FOR UPDATE&lt;/code&gt;&lt;br /&gt;éšå¼ï¼š&lt;code class=&quot;highlighter-rouge&quot;&gt;UPDATE&lt;/code&gt;ã€&lt;code class=&quot;highlighter-rouge&quot;&gt;DELETE&lt;/code&gt;ã€&lt;code class=&quot;highlighter-rouge&quot;&gt;INSERT&lt;/code&gt; è‡ªåŠ¨åŠ é”&lt;/td&gt;
      &lt;td&gt;åŠ åœ¨ç´¢å¼•è®°å½•ä¸Š&lt;/td&gt;
      &lt;td&gt;ä¸ä»»ä½• S/X é”äº’æ–¥&lt;/td&gt;
      &lt;td&gt;å†™å†²çªä¸¥é‡åœºæ™¯ï¼Œéœ€ç‹¬å æ•°æ®ï¼Œå¦‚è®¢å•çŠ¶æ€å˜æ›´ã€åº“å­˜æ‰£å‡ã€èµ„é‡‘è½¬è´¦&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;æ„å‘å…±äº«é”ï¼ˆIS é”ï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;éšå¼ï¼šInnoDB è‡ªåŠ¨åœ¨åŠ è¡Œçº§ S é”å‰äºè¡¨çº§åŠ  IS é”&lt;/td&gt;
      &lt;td&gt;è¡¨çº§&lt;/td&gt;
      &lt;td&gt;ä¸ IX é”ç›¸å®¹ï¼Œä¸è¡¨çº§ X é”äº’æ–¥&lt;/td&gt;
      &lt;td&gt;å†…éƒ¨æœºåˆ¶ï¼Œæé«˜è¡¨é”ä¸è¡Œé”å…¼å®¹æ€§æ£€æŸ¥æ•ˆç‡ï¼ŒDBA ä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;æ„å‘æ’ä»–é”ï¼ˆIX é”ï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;éšå¼ï¼šInnoDB è‡ªåŠ¨åœ¨åŠ è¡Œçº§ X é”å‰äºè¡¨çº§åŠ  IX é”&lt;/td&gt;
      &lt;td&gt;è¡¨çº§&lt;/td&gt;
      &lt;td&gt;ä¸ IS é”ç›¸å®¹ï¼Œä¸è¡¨çº§ X é”äº’æ–¥&lt;/td&gt;
      &lt;td&gt;å†…éƒ¨æœºåˆ¶ï¼ŒåŒä¸Š&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;è‡ªå¢é”ï¼ˆAUTO-INC Lockï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;éšå¼ï¼šæ’å…¥å« &lt;code class=&quot;highlighter-rouge&quot;&gt;AUTO_INCREMENT&lt;/code&gt; åˆ—æ—¶è‡ªåŠ¨åŠ &lt;/td&gt;
      &lt;td&gt;è¡¨çº§ï¼ˆè¯­å¥çº§æˆ–äº‹åŠ¡çº§ï¼Œå–å†³äº &lt;code class=&quot;highlighter-rouge&quot;&gt;innodb_autoinc_lock_mode&lt;/code&gt;ï¼‰&lt;/td&gt;
      &lt;td&gt;é˜»å¡å…¶ä»–ä¼šè¯çš„è‡ªå¢ ID åˆ†é…&lt;/td&gt;
      &lt;td&gt;ä¿è¯è‡ªå¢ä¸»é”®å”¯ä¸€æ€§ï¼Œæ‰¹é‡æ’å…¥æ—¶å¯è°ƒæ¨¡å¼å¹³è¡¡è¿ç»­æ€§ä¸å¹¶å‘æ€§èƒ½&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;&lt;strong&gt;å…ƒæ•°æ®é”ï¼ˆMDL é”ï¼‰&lt;/strong&gt;&lt;/td&gt;
      &lt;td&gt;éšå¼ï¼šä»»ä½• DML/DDL æ“ä½œè‡ªåŠ¨åŠ &lt;/td&gt;
      &lt;td&gt;è¡¨çº§&lt;/td&gt;
      &lt;td&gt;è¯»é”ï¼ˆSHAREDï¼‰ç›¸å®¹ï¼Œå†™é”ï¼ˆEXCLUSIVEï¼‰äº’æ–¥&lt;/td&gt;
      &lt;td&gt;é˜²æ­¢ DML ä¸ DDL å¹¶å‘ä¿®æ”¹è¡¨ç»“æ„ï¼Œéœ€æ³¨æ„é•¿äº‹åŠ¡ä¼šé˜»å¡ DDL&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h3 id=&quot;mysqläº‹åŠ¡éš”ç¦»çº§åˆ«&quot;&gt;MySQLäº‹åŠ¡éš”ç¦»çº§åˆ«&lt;/h3&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;éš”ç¦»çº§åˆ«&lt;/th&gt;
      &lt;th&gt;è„è¯»&lt;/th&gt;
      &lt;th&gt;ä¸å¯é‡å¤è¯»&lt;/th&gt;
      &lt;th&gt;å¹»è¯»&lt;/th&gt;
      &lt;th&gt;MySQL é»˜è®¤&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;READ UNCOMMITTED&lt;/td&gt;
      &lt;td&gt;âŒ å¯èƒ½&lt;/td&gt;
      &lt;td&gt;âŒ å¯èƒ½&lt;/td&gt;
      &lt;td&gt;âŒ å¯èƒ½&lt;/td&gt;
      &lt;td&gt;å¦&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;READ COMMITTED&lt;/td&gt;
      &lt;td&gt;âœ… é¿å…&lt;/td&gt;
      &lt;td&gt;âŒ å¯èƒ½&lt;/td&gt;
      &lt;td&gt;âŒ å¯èƒ½&lt;/td&gt;
      &lt;td&gt;å¦&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;REPEATABLE READ&lt;/td&gt;
      &lt;td&gt;âœ… é¿å…&lt;/td&gt;
      &lt;td&gt;âœ… é¿å…&lt;/td&gt;
      &lt;td&gt;âš ï¸ å¯èƒ½ï¼ˆä½† InnoDB é€šè¿‡ MVCC + é—´éš™é”é¿å…ï¼‰&lt;/td&gt;
      &lt;td&gt;âœ… æ˜¯&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SERIALIZABLE&lt;/td&gt;
      &lt;td&gt;âœ… é¿å…&lt;/td&gt;
      &lt;td&gt;âœ… é¿å…&lt;/td&gt;
      &lt;td&gt;âœ… é¿å…&lt;/td&gt;
      &lt;td&gt;å¦&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;ul&gt;
  &lt;li&gt;è¯»æœªæäº¤ï¼ˆREAD UNCOMMITTEDï¼‰
  Aäº‹åŠ¡å¯ä»¥è¯»å–Bäº‹åŠ¡æœªè°ƒæ•™çš„æ•°æ®ï¼Œå¼•å‘è„è¯»ã€‚&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;è¯»å·²æäº¤ï¼ˆREAD COMMITTEDï¼‰&lt;/p&gt;

    &lt;p&gt;Aäº‹åŠ¡å¯ä»¥è¯»å–Bäº‹åŠ¡å·²æäº¤çš„æ•°æ®&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;font color=&quot;red&quot;&gt;å¯é‡å¤è¯»ï¼ˆREPEATABLE READï¼‰&lt;/font&gt;
    &lt;p&gt;é»˜è®¤çš„äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼Œäº‹åŠ¡å¼€å¯æ—¶ï¼Œä¸åœ¨å…è®¸ä¿®æ”¹æ“ä½œï¼Œå¯é¿å…è„è¯»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åœ¨æŸ¥è¯¢æ—¶åŠ æ’å®ƒé”é¿å…å¹»è¯»ã€‚&lt;/p&gt;
    &lt;ol&gt;
      &lt;li&gt;è¯»å¹»è¯»â€‹ â†’ é  RR éš”ç¦»çº§åˆ« + æ™®é€š SELECTï¼ˆMVCC è‡ªåŠ¨å¤„ç†ï¼‰ã€‚&lt;/li&gt;
      &lt;li&gt;å†™å¹»è¯»â€‹ â†’ ç”¨ SELECT â€¦ FOR UPDATEè§¦å‘ Next-Key Lockï¼ˆPHP ä¸­å°±æ˜¯æ‰§è¡Œè¿™æ¡ SQL å¹¶å¼€å¯äº‹åŠ¡ï¼‰ã€‚&lt;/li&gt;
      &lt;li&gt;ä¸¤è€…ç»“åˆï¼Œå³å¯åœ¨ä¸šåŠ¡ä»£ç ä¸­å¯é é˜²æ­¢å¹»è¯»ã€‚&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;ä¸²è¡Œï¼ˆSERIALIZABLEï¼‰&lt;/p&gt;

    &lt;p&gt;ä¸²è¡Œæ˜¯æœ€é«˜çš„éš”ç¦»çº§åˆ«ï¼Œå¯ä»¥é¿å…è„è¯»ã€å¹»è¯»ã€å¯é‡å¤è¯»ï¼Œä½†æ˜¯æ€§èƒ½å¤ªå·®ã€‚&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;mysqlå­˜å‚¨å¼•æ“&quot;&gt;MySQLå­˜å‚¨å¼•æ“&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;InnoDB&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;InnoDBæ˜¯é»˜è®¤çš„å­˜å‚¨å¼•æ“ï¼Œæ”¯æŒäº‹åŠ¡ã€è¡Œé”ï¼Œæ”¯æŒå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;MyIsAm&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;MyIsAmåœ¨5.5ç‰ˆæœ¬ä¹‹å‰æ˜¯é»˜è®¤çš„é€‰é¡¹ï¼Œä¸æ”¯æŒäº‹åŠ¡ã€è¡Œé”ï¼Œæ”¯æŒè¡¨é”ã€‚é€‚åˆè¯»å¯†é›†åº”ç”¨ï¼Œæ•°æ®å‹ç¼©èƒ½åŠ›å¼ºï¼Œé€‚åˆåªè¯»æ•°æ®å­˜å‚¨ã€‚&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Memory&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;å°†æ‰€æœ‰æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®æ˜“ä¸¢å¤±ã€‚&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Archive&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;è®¾è®¡ç”¨äºå­˜å‚¨å¤§é‡çš„å½’æ¡£æ•°æ®ï¼Œå…·æœ‰é«˜å‹ç¼©ç‡ã€‚åªæ”¯æŒInsertå’ŒSelectæ“ä½œï¼Œéå¸¸é€‚åˆå­˜å‚¨æ—¥å¿—æ•°æ®æˆ–å…¶ä»–å¾ˆå°‘éœ€è¦ä¿®æ”¹çš„æ•°æ®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlé«˜å¯ç”¨æ–¹æ¡ˆ&quot;&gt;MySQLé«˜å¯ç”¨æ–¹æ¡ˆ&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;ä¸»ä»å¤åˆ¶&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€‚åˆè¯»å¯†é›†å‹åº”ç”¨&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;InnoDB Cluster&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;é€‚åˆå¤§è§„æ¨¡å¹¶å‘å†™å…¥åº”ç”¨ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlä¸­utf8å’Œutf8mb4çš„åŒºåˆ«&quot;&gt;MySQLä¸­utf8å’Œutf8mb4çš„åŒºåˆ«&lt;/h3&gt;

&lt;p&gt;mysqlåœ¨5.5.3ä¹‹åå¢åŠ äº†utf8mb4çš„ç¼–ç ï¼Œmb4å°±æ˜¯most bytes4ï¼Œutf8ç¼–ç æœ€å¤§å­—ç¬¦é•¿åº¦ä¸º3å­—èŠ‚ï¼Œå¦‚æœé‡åˆ°4å­—èŠ‚çš„å®½å­—ç¬¦å°±ä¼šæ’å…¥å¼‚å¸¸ã€‚utf8mb4å°±æ˜¯most bytes4çš„æ„æ€ï¼Œä¸“é—¨ç”¨æ¥å…¼å®¹4å­—èŠ‚çš„unicodeå­—ç¬¦ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlä¸­ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«&quot;&gt;MySQLä¸­ä¹è§‚é”å’Œæ‚²è§‚é”çš„åŒºåˆ«ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ã€è¡¨é”ç­‰ï¼Œè¯»é”ã€å†™é”ç­‰ã€‚éƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚
ä¹è§‚é”å’Œæ‚²è§‚é”ä¸»è¦æ˜¯ä¸ºäº†è§£å†³å¹¶å‘äº‹åŠ¡ä¸­çš„æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä»–ä»¬çš„è®¾è®¡åˆè¡·æ˜¯ä¸ºäº†åœ¨å¤šç”¨æˆ·æˆ–è¿›ç¨‹åŒæ—¶è®¿é—®å’Œä¿®æ”¹ç›¸åŒæ•°æ®æ—¶ï¼Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§å’Œå®Œæ•´æ€§ã€‚ä¸¾ä¾‹ï¼šåœ¨ç§’æ€åœºæ™¯ä¸‹å¯¹åº“å­˜çš„æŸ¥è¯¢åŠ é”ï¼Œåœ¨è¿™ä¸ªäº‹åŠ¡ç»“æŸå‰ï¼Œå…¶ä»–å¹¶å‘äº‹åŠ¡éœ€è¦é˜»å¡æ’é˜Ÿç­‰å¾…ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlç´¢å¼•ä¸»è¦æ˜¯å“ªäº›&quot;&gt;MySQLç´¢å¼•ä¸»è¦æ˜¯å“ªäº›ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ç´¢å¼•çš„ç›®çš„æ˜¯æé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œç´¢å¼•çš„ç±»å‹æœ‰å”¯ä¸€ç´¢å¼•ã€æ™®é€šç´¢å¼•ã€ä¸»é”®ç´¢å¼•ã€ç»„åˆç´¢å¼•ã€‚å”¯ä¸€ç´¢å¼•ä¸å¯ä»¥å‡ºç°ç›¸åŒçš„å€¼ï¼Œå¯ä»¥æœ‰Nullå€¼ã€‚&lt;/p&gt;

&lt;p&gt;ç´¢å¼•ä½¿ç”¨æŠ€å·§ï¼Œ1.ä½¿ç”¨çŸ­ç´¢å¼•ï¼Œå¦‚æœæœ‰ä¸€ä¸ªchar(255)åˆ—ï¼Œå¯ä»¥åœ¨å‰10ä¸ªæˆ–20ä¸ªå­—ç¬¦å†…åšçŸ­ç´¢å¼•ã€‚2.ä½¿ç”¨likeè¯­å¥%aaa%ï¼Œä¸ä¼šä½¿ç”¨ç´¢å¼•ï¼Œè€Œ â€œaaa%â€å¯ä»¥ä½¿ç”¨ç´¢å¼•ã€‚3.whereå’Œjoinçš„åˆ—é”®ç´¢å¼•ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ç»„åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™&quot;&gt;ç»„åˆç´¢å¼•æœ€å·¦åŒ¹é…åŸåˆ™ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;åœ¨æŸ¥è¯¢æ•°æ®æ—¶ï¼Œä»è”åˆç´¢å¼•çš„æœ€å·¦è¾¹å¼€å§‹åŒ¹é…ã€‚MySQLä¼šä¸€ç›´å‘å³åŒ¹é…ç›´åˆ°é‡åˆ°èŒƒå›´æŸ¥è¯¢(&amp;gt;ã€&amp;lt;ã€betwwenã€likeå°±åœæ­¢åŒ¹é…äº†)ï¼Œæ¯”å¦‚ç´¢å¼•åˆ—(abcd) where a=1 and c=2 and b&amp;gt;5 and d=6ï¼Œè¿™æ ·cå’Œdéƒ½ä¸ä¼šç”¨åˆ°ç´¢å¼•ã€‚&lt;/p&gt;

&lt;h3 id=&quot;èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«&quot;&gt;èšç°‡ç´¢å¼•å’Œéèšç°‡ç´¢å¼•çš„åŒºåˆ«ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;MyIsAMå­˜å‚¨å¼•æ“æ˜¯éèšç°‡ç´¢å¼•ï¼ŒInnnoDBæ˜¯èšç°‡ç´¢å¼•ã€‚èšç°‡ç´¢å¼•ä¸­ä¸»é”®ç´¢å¼•å­˜æ”¾æ•°æ®ï¼ŒäºŒçº§ç´¢å¼•å­˜å‚¨ç´¢å¼•åˆ—å’Œä¸»é”®åˆ—ã€‚éèšç°‡ç´¢å¼•ä¸»é”®ç´¢å¼•å’ŒäºŒçº§ç´¢å¼•éƒ½å­˜æ”¾å®Œæ•´çš„æ•°æ®ã€‚èšç°‡ç´¢å¼•ä¼šé¢å¤–å ç”¨ç©ºé—´ï¼Œä½†æŸ¥è¯¢æ•ˆç‡é«˜ã€‚&lt;/p&gt;

&lt;h3 id=&quot;å¦‚ä½•æŸ¥è¯¢ä¸€ä¸ªå­—æ®µæ˜¯å¦å‘½ä¸­äº†ç´¢å¼•&quot;&gt;å¦‚ä½•æŸ¥è¯¢ä¸€ä¸ªå­—æ®µæ˜¯å¦å‘½ä¸­äº†ç´¢å¼•ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨explainåˆ†æSQLæ˜¯å¦èµ°äº†ç´¢å¼•ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlä¸­çš„mvccæ˜¯ä»€ä¹ˆ&quot;&gt;Mysqlä¸­çš„MVCCæ˜¯ä»€ä¹ˆï¼Ÿ&lt;/h3&gt;

&lt;p&gt;å¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶Multiversion concurrency controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶å¸¸ç”¨çš„æ˜¯æ‰€ï¼Œç»™å½“å‰äº‹åŠ¡DQLåŠ æ¯’ç´ å“¦ï¼Œç»™DMLåŠ å†™é”ï¼Œè¿™ç§é”æ˜¯ä¸€ç§æ‚²è§‚é”çš„å®ç°æ–¹å¼ï¼Œä¼šé˜»å¡å…¶ä»–äº‹åŠ¡ï¼Œä»è€Œå½±å“æ•°æ®åº“æ€§èƒ½ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlè¯»å†™åˆ†ç¦»ä»¥åŠä¸»ä»åŒæ­¥&quot;&gt;MySQLè¯»å†™åˆ†ç¦»ä»¥åŠä¸»ä»åŒæ­¥ã€‚&lt;/h3&gt;

&lt;p&gt;åŸç†ï¼Œä¸»åº“å°†å˜æ›´å†™binlogæ—¥å¿—ï¼Œç„¶åä»åº“é“¾æ¥åˆ°ä¸»åº“åï¼Œä»åº“æœ‰ä¸€ä¸ªIOçº¿ç¨‹å°†ä¸»åº“çš„binlogæ—¥å¿—æ‹·è´åˆ°è‡ªå·±æœ¬åœ°ï¼Œå†™å…¥ä¸€ä¸ªä¸­ç»§æ—¥å¿—ï¼Œæ¥ç€ä»åº“æœ‰ä¸€ä¸ªsqlçº¿ç¨‹ä»ä¸­ç»§æ—¥å¿—è¯»å–binlogç„¶åæ‰§è¡Œbinlogæ—¥å¿—çš„å†…å®¹ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlå¦‚ä½•ä¿è¯ä¸€è‡´æ€§å’ŒæŒä¹…æ€§&quot;&gt;Mysqlå¦‚ä½•ä¿è¯ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;Mysqlä¸ºäº†ä¿è¯ACIDä¸­çš„ä¸€è‡´æ€§å’ŒæŒä¹…æ€§ï¼Œä½¿ç”¨äº†WAL(Write A head logging)ï¼Œå…ˆå†™æ—¥å¿—åœ¨å†™ç£ç›˜ã€‚Redologå°±æ˜¯ä¸€å¼ WALçš„åº”ç”¨ï¼Œå½“æ•°æ®åº“å¿½ç„¶æ–­ç‚¹åœ¨é‡æ–°å¯åŠ¨æ—¶ï¼ŒMysqlå¯ä»¥é€šè¿‡Redologè¿˜åŸæ•°æ®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¸ºä»€ä¹ˆé€‰bæ ‘ä½œä¸ºç´¢å¼•ç»“æ„&quot;&gt;ä¸ºä»€ä¹ˆé€‰B+æ ‘ä½œä¸ºç´¢å¼•ç»“æ„ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;1.éå¶å­èŠ‚ç‚¹ä»…å­˜ç´¢å¼•ï¼ˆé”®å€¼å’ŒæŒ‡é’ˆï¼‰ï¼Œæ”¯æŒé«˜æ•ˆèŒƒå›´æŸ¥è¯¢ã€‚2.å¶å­èŠ‚ç‚¹å­˜æ•°æ®å¹¶é“¾è¡¨è¿æ¥å¤©ç„¶æ”¯æŒæ°´å¹³æ‰©å±•ç†è®ºå­˜å‚¨å®¹é‡ä»…å—ç£ç›˜æ€»ç©ºé—´é™åˆ¶ã€‚3.B+æ ‘çš„èŠ‚ç‚¹ï¼ˆéå¶å­å’Œå¶å­ï¼‰å¤§å°è®¾è®¡ä¸ºç£ç›˜é¡µï¼ˆ16KBï¼‰å¤§å°ï¼Œè®©B+æ ‘æŸ¥è¯¢æ—¶ç”¨æœ€å°‘çš„I/Oå®šä½æ•°æ®ã€‚&lt;/p&gt;

&lt;h3 id=&quot;innnodbçš„è¡Œé”æ¨¡å¼&quot;&gt;InnnoDBçš„è¡Œé”æ¨¡å¼ï¼Ÿ&lt;/h3&gt;

&lt;p&gt;1.å…±äº«é”(s)ï¼Œç”¨æ³•lock in share modeåˆç§°è¯»é”ï¼Œ2. æ’å®ƒé”ï¼Œåˆç§°å†™é”ã€‚
sé”ï¼Œè‹¥äº‹åŠ¡Tå¯¹æ•°æ®å¯¹è±¡AåŠ ä¸ŠSé”ï¼Œå…¶ä»–äº‹åŠ¡æ™ºèƒ½å¯¹AåŠ Sé”ï¼Œè€Œä¸èƒ½åŠ Xé”ã€‚
xé”ï¼Œè‹¥äº‹åŠ¡Tå¯¹æ•°æ®å¯¹è±¡åŠ ä¸ŠXé”ï¼Œäº‹åŠ¡Tå¯ä»¥è¯»Aä¹Ÿå¯ä»¥å†™Aï¼Œå…¶ä»–äº‹åŠ¡ä¸èƒ½åœ¨å¯¹AåŠ ä»»ä½•é”ï¼ŒXé”ç”¨æ³•for updateã€‚&lt;/p&gt;

&lt;h3 id=&quot;å“ˆå¸Œhashæ¯”æ ‘treeæ›´å¿«ç´¢å¼•ç»“æ„ä¸ºä»€ä¹ˆè®¾è®¡æˆæ ‘å½¢&quot;&gt;å“ˆå¸Œ(hash)æ¯”æ ‘(tree)æ›´å¿«ï¼Œç´¢å¼•ç»“æ„ä¸ºä»€ä¹ˆè®¾è®¡æˆæ ‘å½¢&lt;/h3&gt;

&lt;p&gt;å“ˆå¸ŒæŸ¥è¯¢ã€æ’å…¥ã€ä¿®æ”¹ã€åˆ é™¤çš„å¹³å‡å“åº”æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(1)ï¼Œæ ‘çš„å¹³å‡å“åº”æ—¶é—´å¤æ‚åº¦æ˜¯O(logmN)ï¼Œå“ˆå¸Œåªèƒ½æ»¡è¶³ç­‰å€¼æŸ¥è¯¢ï¼Œä¸èƒ½æ»¡è¶³èŒƒå›´å’Œå¤§å°æŸ¥è¯¢ï¼Œå…¶æ¬¡ä¸å¯ä»¥æ’åºã€‚&lt;/p&gt;

&lt;h3 id=&quot;ä¸ºä»€ä¹ˆç´¢å¼•çš„keyé•¿åº¦ä¸èƒ½å¤ªé•¿&quot;&gt;ä¸ºä»€ä¹ˆç´¢å¼•çš„keyé•¿åº¦ä¸èƒ½å¤ªé•¿ã€‚&lt;/h3&gt;

&lt;p&gt;keyå¤ªé•¿ä¼šå¯¼è‡´ä¸€ä¸ªé¡µå½“ä¸­èƒ½å¤Ÿæ‘æ˜‚çš„keyæ•°ç›®å˜å°ï¼Œé—´æ¥å¯¼è‡´ç´¢å¼•æ ‘çš„é¡µæ•°å˜å¤šï¼Œç´¢å¼•å±‚æ¬¡å¢åŠ ã€‚ä»è€Œå½±å“æŸ¥è¯¢æ•ˆç‡ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlçš„æ•°æ®å¦‚ä½•æ¢å¤åˆ°ä»»æ„æ—¶é—´ç‚¹&quot;&gt;MySQLçš„æ•°æ®å¦‚ä½•æ¢å¤åˆ°ä»»æ„æ—¶é—´ç‚¹&lt;/h3&gt;

&lt;p&gt;1.å¯ç”¨äºŒè¿›åˆ¶æ—¥å¿—ã€‚2.é¦–å…ˆä½¿ç”¨æœ€è¿‘ä¸€æ¬¡çš„å¤‡ä»½æ¢å¤æ•°æ®åº“ã€‚3.ä½¿ç”¨mysqlbinlogå·¥å…·å°†binlogæ–‡ä»¶åˆå¹¶ï¼Œç„¶åä½¿ç”¨mysqlå·¥å…·å¯¼å…¥å·²åˆå¹¶çš„sqlæ–‡ä»¶ã€‚&lt;/p&gt;

&lt;h3 id=&quot;mysqlä¸ºä»€ä¹ˆåŠ äº†ç´¢å¼•å¯ä»¥åŠ å¿«æŸ¥è¯¢&quot;&gt;Mysqlä¸ºä»€ä¹ˆåŠ äº†ç´¢å¼•å¯ä»¥åŠ å¿«æŸ¥è¯¢&lt;/h3&gt;

&lt;p&gt;ä½¿ç”¨ç´¢å¼•åå†æŸ¥è¯¢æ—¶ä¸ç”¨æ‰«æå…¨è¡¨æ¥å®šä½ã€‚&lt;/p&gt;

&lt;h3 id=&quot;explainå‘½ä»¤æœ‰ä»€ä¹ˆç”¨&quot;&gt;Explainå‘½ä»¤æœ‰ä»€ä¹ˆç”¨&lt;/h3&gt;

&lt;p&gt;åˆ†ææ…¢æŸ¥è¯¢è¯­å¥æœ‰æ²¡æœ‰å‘½ä¸­ç´¢å¼•ã€‚&lt;/p&gt;</content><author><name>Zhao Q.H.</name></author><category term="é¢è¯•" /><category term="mysql" /><summary type="html">MySQL</summary></entry><entry><title type="html">Go Rediså­¦ä¹ ç¬”è®°</title><link href="http://localhost:4000/go/2025/09/23/go-redis-note/" rel="alternate" type="text/html" title="Go Rediså­¦ä¹ ç¬”è®°" /><published>2025-09-23T00:00:00+08:00</published><updated>2025-09-23T00:00:00+08:00</updated><id>http://localhost:4000/go/2025/09/23/go-redis-note</id><content type="html" xml:base="http://localhost:4000/go/2025/09/23/go-redis-note/">&lt;h2 id=&quot;å®‰è£…&quot;&gt;å®‰è£…&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;go get github.com/redis/go-redis/v9

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;ä½¿ç”¨ä¾‹å­&quot;&gt;ä½¿ç”¨ä¾‹å­&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;context&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;log&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;time&quot;&lt;/span&gt;

	&lt;span class=&quot;s2&quot;&gt;&quot;github.com/redis/go-redis/v9&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;redis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;NewClient&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;redis&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Options&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;Addr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;     &lt;span class=&quot;s2&quot;&gt;&quot;localhost:16379&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;Password&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;CXqwr12_&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;no&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;set&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;DB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;       &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;          &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DB&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;pong&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err2&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Ping&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err2&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;nb&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;redis connect failed,err:%v&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;redis connect success:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pong&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;redis-go-value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;nb&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;set key failed,err:%v&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-key2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;redis-go-value2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;300&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-key3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;redis-go-value3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-key4&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;redis-go-value3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;160&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Second&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-hash-key1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;hash-value1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-hash-key1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;hash-value2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HSet&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-hash-key1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;hash-value3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;panic&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;nb&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;get key failed,err:%v&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;val&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;deleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Del&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-key3&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-key2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;nb&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;delete key failed,err:%v&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;deleted is &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;deleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;rdb&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HDel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;go-redis-hash-key1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;field2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;nb&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;delete key failed,err:%v&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HDel deleted is &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;deleted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;å‚è€ƒèµ„æ–™&quot;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://github.com/redis/go-redis&quot; target=&quot;_blank&quot;&gt;https://github.com/redis/go-redis&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://redis.uptrace.dev/zh/&quot; target=&quot;_blank&quot;&gt;https://redis.uptrace.dev/zh/&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://pkg.go.dev/github.com/redis/go-redis/v9@v9.14.0#section-readme&quot; target=&quot;_blank&quot;&gt;https://pkg.go.dev/github.com/redis/go-redis/v9@v9.14.0#section-readme&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Zhao Q.H.</name></author><category term="Go" /><summary type="html">å®‰è£… ``` go get github.com/redis/go-redis/v9</summary></entry><entry><title type="html">Go Gorm Mysqlå­¦ä¹ ç¬”è®°</title><link href="http://localhost:4000/go/2025/09/23/go-gorm-mysql-note/" rel="alternate" type="text/html" title="Go Gorm Mysqlå­¦ä¹ ç¬”è®°" /><published>2025-09-23T00:00:00+08:00</published><updated>2025-09-23T00:00:00+08:00</updated><id>http://localhost:4000/go/2025/09/23/go-gorm-mysql-note</id><content type="html" xml:base="http://localhost:4000/go/2025/09/23/go-gorm-mysql-note/">&lt;h2 id=&quot;å®‰è£…&quot;&gt;å®‰è£…&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;go get -u gorm.io/gorm
go get -u gorm.io/driver/sqlite
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;è¿æ¥æ•°æ®åº“&quot;&gt;è¿æ¥æ•°æ®åº“&lt;/h2&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;context&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;encoding/json&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

	&lt;span class=&quot;s2&quot;&gt;&quot;gorm.io/driver/mysql&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;gorm.io/gorm&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{})&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;root:12345678@tcp(127.0.0.1:13301)/nextcloud?charset=utf8mb4&amp;amp;collation=utf8mb4_bin&amp;amp;parseTime=True&amp;amp;loc=Local&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;æ¨¡å‹&quot;&gt;æ¨¡å‹&lt;/h2&gt;

&lt;h3 id=&quot;gormmodel&quot;&gt;gorm.Model&lt;/h3&gt;
&lt;p&gt;gorm.Modelæ˜¯gormé¢„å®šä¹‰çš„ç»“æ„ä½“ï¼Œåœ¨è‡ªå®šä¹‰çš„ç»“æ„ä½“æ¨¡å‹ä¸­å¯ä»¥å¼•å…¥ä½¿ç”¨ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;gorm.Model definition&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// gorm.Model definition
type Model struct {
  ID        uint           `gorm:&quot;primaryKey&quot;`
  CreatedAt time.Time
  UpdatedAt time.Time
  DeletedAt gorm.DeletedAt `gorm:&quot;index&quot;`
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;mygormmodeltestæ¨¡å‹&quot;&gt;myGormModelTestæ¨¡å‹&lt;/h3&gt;
&lt;h4 id=&quot;å®šä¹‰å’Œæ‰§è¡Œ&quot;&gt;å®šä¹‰å’Œæ‰§è¡Œ&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;context&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;encoding/json&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

	&lt;span class=&quot;s2&quot;&gt;&quot;gorm.io/driver/mysql&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;gorm.io/gorm&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;myGormModelTest&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Model&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{})&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;root:12345678@tcp(127.0.0.1:13301)/nextcloud?charset=utf8mb4&amp;amp;collation=utf8mb4_bin&amp;amp;parseTime=True&amp;amp;loc=Local&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;connect db failed,err:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gorm:table_options&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AutoMigrate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;myGormModelTest&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{})&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;migrate failed,err:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„æ˜¯&quot;&gt;ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„æ˜¯&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;show create table my_gorm_model_tests
CREATE TABLE `my_gorm_model_tests` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `created_at` datetime(3) DEFAULT NULL,
  `updated_at` datetime(3) DEFAULT NULL,
  `deleted_at` datetime(3) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_my_gorm_model_tests_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;useræ¨¡å‹&quot;&gt;Useræ¨¡å‹&lt;/h3&gt;
&lt;h4 id=&quot;å®šä¹‰å’Œæ‰§è¡Œ-1&quot;&gt;å®šä¹‰å’Œæ‰§è¡Œ&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;context&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;encoding/json&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

	&lt;span class=&quot;s2&quot;&gt;&quot;gorm.io/driver/mysql&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;gorm.io/gorm&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;User&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Model&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;UserName&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column:user_name;size:100;not null;default:'';&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;      &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column:user_age&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Email&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column:user_email&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Phone&lt;/span&gt;    &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column:user_phone&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;u&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TableName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;my_gorm_user&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{})&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;root:12345678@tcp(127.0.0.1:13301)/nextcloud?charset=utf8mb4&amp;amp;collation=utf8mb4_bin&amp;amp;parseTime=True&amp;amp;loc=Local&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;ctx&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Background&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;connect db failed,err:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä½¿ç”¨&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AutoMigrate&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¿›è¡Œè¿ç§»&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Set&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gorm:table_options&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AutoMigrate&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;User&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{})&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;migrate failed,err:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„æ˜¯-1&quot;&gt;ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„æ˜¯&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;show create table my_gorm_user
CREATE TABLE `my_gorm_user` (
  `user_name` varchar(100) COLLATE utf8mb4_bin NOT NULL DEFAULT '',
  `user_age` bigint DEFAULT NULL,
  `user_email` longtext COLLATE utf8mb4_bin,
  `user_phone` longtext COLLATE utf8mb4_bin,
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `created_at` datetime(3) DEFAULT NULL,
  `updated_at` datetime(3) DEFAULT NULL,
  `deleted_at` datetime(3) DEFAULT NULL,
  PRIMARY KEY (`id`),
  KEY `idx_my_gorm_user_deleted_at` (`deleted_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;ä½¿ç”¨ä¾‹å­&quot;&gt;ä½¿ç”¨ä¾‹å­&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;encoding/json&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

	&lt;span class=&quot;s2&quot;&gt;&quot;gorm.io/driver/mysql&quot;&lt;/span&gt;
	&lt;span class=&quot;s2&quot;&gt;&quot;gorm.io/gorm&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OcFileCacheQuery&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Fileid&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;    &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column:fileid&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column:name&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;   &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;column:path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;`&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mysql&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;gorm&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Config&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{})&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;root:12345678@tcp(127.0.0.1:13301)/nextcloud?charset=utf8mb4&amp;amp;parseTime=True&amp;amp;loc=Local&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;connectDB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dsn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;connect db failed,err:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fileCacheList&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OcFileCacheQuery&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;whereFileId&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;wherePath&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;files/%&quot;&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;LimitNum&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Table&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;oc_filecache&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;Select&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;fileid,name,path&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;Where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;fileid &amp;gt; ?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;whereFileId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;Where&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;path LIKE ?&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;wherePath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;Limit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LimitNum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;Order&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;fileid desc&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;Find&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fileCacheList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;éå†ç»“æœ&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;fileCacheList:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fileCacheList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;fileCacheList type is %T&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fileCacheList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;len is &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fileCacheList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;å†…å®¹å¦‚ä¸‹:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;range&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fileCacheList&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; 	&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;jsonBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Marshal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fileCacheList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;!= nil {
&lt;/span&gt;		&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;json marshal failed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
		&lt;span class=&quot;n&quot;&gt;return&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jsonBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;jsonStr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jsonBytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;jsonStr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fileCacheList&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
	&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;db&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;err&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;


&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;å‚è€ƒèµ„æ–™&quot;&gt;å‚è€ƒèµ„æ–™&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://gorm.io/docs/&quot; target=&quot;_blank&quot;&gt;https://gorm.io/docs/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</content><author><name>Zhao Q.H.</name></author><category term="Go" /><category term="go" /><category term="gorm" /><category term="mysql" /><summary type="html">å®‰è£… go get -u gorm.io/gorm go get -u gorm.io/driver/sqlite è¿æ¥æ•°æ®åº“ ``` package main</summary></entry><entry><title type="html">Go è¯­è¨€å­¦ä¹ ç¬”è®°</title><link href="http://localhost:4000/go/2025/09/18/go-study-note/" rel="alternate" type="text/html" title="Go è¯­è¨€å­¦ä¹ ç¬”è®°" /><published>2025-09-18T00:00:00+08:00</published><updated>2025-09-18T00:00:00+08:00</updated><id>http://localhost:4000/go/2025/09/18/go-study-note</id><content type="html" xml:base="http://localhost:4000/go/2025/09/18/go-study-note/">&lt;h2 id=&quot;æ•°æ®ç±»å‹&quot;&gt;æ•°æ®ç±»å‹&lt;/h2&gt;
&lt;p&gt;Go è¯­è¨€ä¸­çš„æ•°æ®ç±»å‹å¯ä»¥ä»ä¸åŒç»´åº¦è¿›è¡Œåˆ†ç±»ã€‚æŒ‰ç»„æˆç»“æ„â€‹â€‹ï¼Œåˆ†ä¸ºåŸºæœ¬ç±»å‹å’Œå¤åˆç±»å‹ã€‚â€‹â€‹æŒ‰èµ‹å€¼ä¼ é€’è¡Œä¸ºâ€‹â€‹åˆ†ä¸ºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ã€‚&lt;/p&gt;
&lt;h3 id=&quot;åŸºç¡€ç±»å‹&quot;&gt;åŸºç¡€ç±»å‹&lt;/h3&gt;
&lt;p&gt;æ„æˆç¨‹åºçš„åŸºç¡€ï¼Œä¸å¯å†æ‹†åˆ†ï¼Œå†…å­˜å ç”¨å›ºå®š&lt;/p&gt;
&lt;h4 id=&quot;å¸ƒå°”&quot;&gt;å¸ƒå°”&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var b1 bool
b1 = true
b2 := false
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;å­—ç¬¦ä¸²&quot;&gt;å­—ç¬¦ä¸²&lt;/h4&gt;
&lt;p&gt;string å’Œ byte[]ï¼Œstringå¯ä»¥ç›´æ¥è½¬æ¢æˆbyteå­—èŠ‚åˆ‡ç‰‡&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;	var (
		str1 string = &quot;hello string&quot;
	)
	str2 := &quot;hello str2&quot;
	fmt.Println(str1, str2)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;æ•´å‹&quot;&gt;æ•´å‹&lt;/h4&gt;
&lt;p&gt;11ç§å†…ç½®æ•´æ•°ç±»å‹ï¼šint8ã€uint8ã€int16ã€uint16ã€int32ã€uint32ã€int64ã€uint64ã€intã€uintå’Œuintptr&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var a int = 10
var i1, i2 int = 10, 20
i3 := 30                  //é»˜è®¤ç±»å‹æ˜¯int
fmt.Println(i1, i2, i3)
fmt.Printf(&quot;i1 type is %T\n &quot;, i1)
fmt.Printf(&quot;i3 type is %T\n\n &quot;, i3)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;æµ®ç‚¹å‹&quot;&gt;æµ®ç‚¹å‹&lt;/h4&gt;
&lt;p&gt;ä¸¤ç§å†…ç½®æµ®ç‚¹æ•°ç±»å‹ï¼šfloat32å’Œfloat64ã€‚&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var f1 float32 = 3.14
f2 := 3.14              //é»˜è®¤æ•°æ®ç±»å‹æ˜¯float64
fmt.Println(f1, f2)
fmt.Printf(&quot;f2 type is %T\n &quot;, f2)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;å¤æ•°&quot;&gt;å¤æ•°&lt;/h4&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var cmp1 complex64 = 1 + 2i
cmp2 := 2 + 4i        //é»˜è®¤å€¼æ˜¯complex128
fmt.Println(cmp1, cmp2)
fmt.Printf(&quot;cmp2 type is %T\n&quot;, cmp2)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;é›¶å‹&quot;&gt;é›¶å‹&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var (
  zb   bool
  zs   string
  zi   int
  zf   float64
  zcmp complex128
)
fmt.Println(zb, zs, zi, zf, zcmp)
è¾“å‡ºç»“æœä¸º
false  0 0 (0+0i)

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;å¸¸é‡&quot;&gt;å¸¸é‡&lt;/h4&gt;

&lt;h3 id=&quot;å¤åˆç±»å‹&quot;&gt;å¤åˆç±»å‹&lt;/h3&gt;
&lt;p&gt;ç”±åŸºæœ¬ç±»å‹æˆ–å…¶ä»–å¤åˆç±»å‹ç»„åˆè€Œæˆï¼Œç”¨äºæ„å»ºæ›´å¤æ‚çš„æ•°æ®ç»“æ„&lt;/p&gt;
&lt;h4 id=&quot;æ•°ç»„&quot;&gt;æ•°ç»„&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;å®šä¹‰æ•°ç»„
    &lt;ul&gt;
      &lt;li&gt;var å˜é‡å [é•¿åº¦]ç±»å‹&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åˆå§‹åŒ–å®šä¹‰æ•°ç»„
    &lt;ol&gt;
      &lt;li&gt;var å˜é‡å = [é•¿åº¦]ç±»å‹{v1,v2,v3}&lt;/li&gt;
      &lt;li&gt;var å˜é‡å = [â€¦]ç±»å‹{v1,v2,v3}&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//æ•°ç»„
var arr = [5]int{1, 2, 3, 4, 5}
var arr1 [3]int
var arr2 = [3]int{1, 2, 3}
arr3 := [3]int{4, 5, 6}
var arr4 = [...]int{1, 2, 3}
arr5 := [...]int{4, 5, 6}
fmt.Println(arr1, arr2, arr3, arr4, arr5)
for i, v := range arr2 {
  fmt.Println(i, v)
}
// å†’æ³¡æ’åº
for i := 0; i &amp;lt; len(arr)-1; i++ {
  for j := 0; j &amp;lt; len(arr)-1-i; j++ {
    if arr[j] &amp;lt; arr[j+1] {
      arr[j], arr[j+1] = arr[j+1], arr[j]
    }
    fmt.Println(&quot;aa:&quot;, arr)
  }
  fmt.Println(&quot;aaa:&quot;, arr)
}

fmt.Println(arr)

//å¤šç»´æ•°ç»„å®šä¹‰å’Œéå†
var arrM3 = [3][2]int{ {1, 2}, {3, 4}, {5, 6}}
for i := 0; i &amp;lt; len(arrM3); i++ {
  for j := 0; j &amp;lt; len(arrM3[i]); j++ {
    fmt.Printf(&quot;%d &quot;, arrM3[i][j])
  }
}
for _, val := range arrM3 {
  for index2, val2 := range val {
    fmt.Printf(&quot;index is %d,val is %d \n&quot;, index2, val2)
  }
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;åˆ‡ç‰‡&quot;&gt;åˆ‡ç‰‡&lt;/h4&gt;
&lt;p&gt;å¼•ç”¨ç±»å‹&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å®šä¹‰åˆ‡ç‰‡
    &lt;ul&gt;
      &lt;li&gt;var å˜é‡å []ç±»å‹ï¼Œä¸éœ€è¦æŒ‡å®šé•¿åº¦ã€‚&lt;/li&gt;
      &lt;li&gt;å˜é‡å := make([]int,len,cap)ï¼Œè¿™ç§éœ€è¦åˆç†é¢„ä¼°åˆ‡ç‰‡å®¹é‡å¤§å°ï¼Œå¦‚æœé¢„ä¼°è¿‡å¤§ä¼šé€ æˆå†…å­˜æµªè´¹ï¼Œé¢„ä¼°å‡†ç¡®ä¼šæå‡æ€§èƒ½ã€‚
        &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;var slice1 []int
slice2 := []int{1, 2, 3}
var slice3 = make([]int, 0)
slice4 := make([]int, 0)
fmt.Println(slice1, slice2, slice3, slice4)
fmt.Printf(&quot;slice1 type is %T\nslice2 type is %T\n&quot;, slice1, slice2)
fmt.Printf(&quot;slice1 type is %T\n&quot;, slice1)
fmt.Println(slice1 == nil)
slice1 = append(slice1, 1)
slice1 = append(slice1, 2, 3, 4)
fmt.Println(slice1 == nil)
fmt.Println(slice1)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;åˆ‡ç‰‡å¸¸ç”¨æ“ä½œ
    &lt;ul&gt;
      &lt;li&gt;æ·»åŠ ï¼Œappend&lt;/li&gt;
      &lt;li&gt;æˆªå–ï¼Œslice[start:end]ï¼Œstartæˆ–è€…endéƒ½å¯ä»¥çœç•¥&lt;/li&gt;
      &lt;li&gt;å¤åˆ¶ï¼Œcopy(ç›®æ ‡åˆ‡ç‰‡ï¼Œæºåˆ‡ç‰‡)ï¼Œå¤åˆ¶è¦†ç›–åŒä½ç½®çš„å…ƒç´ ï¼Œä¸ä¼šæ”¹å˜åˆ‡ç‰‡çš„é•¿åº¦ã€‚&lt;/li&gt;
      &lt;li&gt;åˆ é™¤,slice[:2],åˆ é™¤ç¬¬äºŒä¸ªä»¥åæ‰€æœ‰çš„å…ƒç´ ï¼Œslice[2:]ï¼Œåˆ é™¤ç¬¬äºŒä¸ªå’Œå‰é¢çš„å…ƒç´ 
        &lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;slice1 := []int{1, 2, 3}
slice2 := []int{4, 5, 6}
slice1 = append(slice1, 7)
//slice1 = slice1[:2]
copy(slice1, slice2)
fmt.Println(slice1, slice2)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;
        &lt;h4 id=&quot;é›†åˆæ˜ å°„&quot;&gt;é›†åˆã€æ˜ å°„&lt;/h4&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;å®šä¹‰æ–¹å¼
    &lt;ul&gt;
      &lt;li&gt;map[é”®çš„ç±»å‹]å€¼çš„ç±»å‹&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
 //å®šä¹‰ä¸€ä¸ªç©ºé›†åˆã€æ˜ å°„ã€‚
ma := map[string]int{}
ma[&quot;a&quot;] = 1
fmt.Println(ma)
//åˆå§‹åŒ–å®šä¹‰ä¸€ä¸ªéç©ºé›†åˆã€æ˜ å°„ã€‚
m1 := map[string]int{&quot;a&quot;: 1, &quot;b&quot;: 2}
//å®šä¹‰ä¸€ä¸ªç©ºé›†åˆã€æ˜ å°„ã€‚
m2 := make(map[string]string)
//m2[&quot;a&quot;] = 1
m2[&quot;b&quot;] = &quot;hello&quot;
//m2[3] = 3.14
m2[&quot;name&quot;] = &quot;tom&quot;
m2[&quot;age&quot;] = &quot;20&quot;
m2[&quot;city&quot;] = &quot;beijing&quot;
delete(m2, &quot;city&quot;)
//m2[&quot;city&quot;] = &quot;shanghai&quot;
//å°†jsonå­—ç¬¦ä¸²è½¬æ¢æˆmapé›†åˆã€‚
var j string
j = `{&quot;infos&quot;:[{&quot;name&quot;:&quot;tom&quot;,&quot;age&quot;:20,&quot;city&quot;:&quot;beijing&quot;},{&quot;name&quot;:&quot;jack&quot;,&quot;age&quot;:22,&quot;city&quot;:&quot;shanghai&quot;}]}`
fmt.Println(j)
var m3 = map[string]any{}
json.Unmarshal([]byte(j), &amp;amp;m3)
for key, val := range m3 {
  fmt.Println(&quot;key is &quot;, key)
  fmt.Println(&quot;val is &quot;, val)
  //valSlice := val.([]interface{})
  //valSlice := val.([]any)
  valSlice := val.([]interface{})
  for index, val2 := range valSlice {
    fmt.Println(&quot;index is &quot;, index)
    fmt.Println(&quot;val2 is &quot;, val2)
    valMap := val2.(map[string]any)
    for key3, val3 := range valMap {
      fmt.Printf(&quot;key3 is %s,val3 is %v \n&quot;, key3, val3)
    }
  }

}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;å‡½æ•°&quot;&gt;å‡½æ•°&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;func sum(a,b int) int{
  return a+b
}
func main(){
  sumInt := sum(1,2)
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;æ–¹æ³•&quot;&gt;æ–¹æ³•&lt;/h4&gt;

&lt;p&gt;å‡½æ•°å’Œæ–¹æ³•çš„åŒºåˆ«æ˜¯æ–¹æ³•æœ‰ä¸€ä¸ªç±»å‹æ¥æ”¶è€…ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;type Age int

func (age Age) Hello() {
	fmt.Println(&quot;hello&quot;, age)
}
func main(){
  age := Age(10)
  age.Hello
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;ç»“æ„ä½“&quot;&gt;ç»“æ„ä½“&lt;/h4&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;type Book struct {
	Name   string
	Price  float64
	Author string
	Page   int
}
//ç»“æ„ä½“å®šä¹‰æ–¹æ³•
func (b Book) HelloName() {
	fmt.Println(&quot;book name is &quot;, b.Name)
}
func (b Book) Pages() int {
	return b.Page
}
func (b *Book) SetPages(page int) int {
	b.Page = page
	return b.Page
}
function main(){
  Book1 := Book{Name: &quot;Go&quot;,Price: 66.6, Author: &quot;tom&quot;}
  Book1.HelloName()
  var Book1 Book
	Book1.SetPages(200)
	pages := Book1.Pages()
	fmt.Println(pages)
	return
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;æ¥å£&quot;&gt;æ¥å£&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;æ¥å£çš„å®šä¹‰
  æ¥å£çš„å®šä¹‰ä¸ç»“æ„ä½“ç¨å¾®æœ‰äº›å·®åˆ«ï¼Œè™½ç„¶éƒ½ä»¥typeå…³é”®å­—å¼€å§‹ï¼Œä½†æ¥å£çš„å…³é”®å­—æ˜¯interfaceï¼Œè¡¨ç¤ºå®šä¹‰çš„ç±»å‹æ˜¯ä¸€ä¸ªæ¥å£ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;type Stringer interface {
  String() string
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;æ¥å£çš„å®ç°
  æ¥å£çš„å®ç°è€…å¿…é¡»æ˜¯ä¸€ä¸ªå…·ä½“çš„ç±»å‹ï¼Œä»¥personç»“æ„ä½“ä¸ºä¾‹ï¼Œè®©å®ƒæ¥å®ç°Stringeræ¥å£ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤º&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;type Stringer interface {
  String() string
}
type Address struct {
    province string
    city string
}
type Person struct{
  Name String
  Age int
  Address Address
}
func (p Person) String() string {
  return fmt.Sprintf(&quot;the name is %s,age is %d&quot;,p.name,p.age)

}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h4 id=&quot;é€šé“&quot;&gt;é€šé“&lt;/h4&gt;
&lt;p&gt;â€‹â€‹ä¸è¦åœ¨åŒä¸€ä¸ª goroutine ä¸­ï¼Œå¯¹æ— ç¼“å†² channel é¡ºåºæ‰§è¡Œå…ˆæ¥æ”¶åå‘é€æˆ–å…ˆå‘é€åæ¥æ”¶çš„æ“ä½œâ€‹â€‹ï¼Œè¿™ä¼šå¯¼è‡´è¯¥ goroutine é˜»å¡ï¼Œä»è€Œä½¿åç»­çš„é…å¯¹æ“ä½œæ²¡æœ‰æœºä¼šæ‰§è¡Œã€‚åŠ¡å¿…è®©å®ƒä»¬åœ¨ä¸¤ä¸ªä¸åŒçš„ goroutine ä¸­å¹¶å‘æ‰§è¡Œã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;func main(){
ch3 := make(chan int)
go func() {
  ch3 &amp;lt;- 100
}()
ch100 := &amp;lt;-ch3
fmt.Println(&quot;ch100 is &quot;, ch100)
return
ch2 := make(chan int, 1)  //å¸¦ç¼“å†²åŒºçš„é€šé“
ch2 &amp;lt;- 1
//ch2 &amp;lt;- 2
cha1 := &amp;lt;-ch2
//cha2 := &amp;lt;-ch2
fmt.Println(cha1)
return
}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;å€¼ç±»å‹&quot;&gt;å€¼ç±»å‹&lt;/h3&gt;

&lt;p&gt;â€‹â€‹èµ‹å€¼å’Œä¼ å‚æ—¶å¤åˆ¶æ•´ä¸ªæ•°æ®çš„å‰¯æœ¬â€‹â€‹ï¼Œæ“ä½œæ–°å‰¯æœ¬ä¸ä¼šå½±å“åŸæ•°æ®ã€‚
æ‰€æœ‰â€‹â€‹åŸºæœ¬ç±»å‹â€‹â€‹ã€â€‹â€‹æ•°ç»„ (array)â€‹â€‹ã€â€‹â€‹ç»“æ„ä½“ (struct)â€‹â€‹&lt;/p&gt;

&lt;h3 id=&quot;å¼•ç”¨ç±»å‹&quot;&gt;å¼•ç”¨ç±»å‹&lt;/h3&gt;

&lt;p&gt;â€‹â€‹èµ‹å€¼å’Œä¼ å‚æ—¶å¤åˆ¶æ•°æ®çš„å¼•ç”¨ï¼ˆå†…å­˜åœ°å€ï¼‰â€‹â€‹ï¼Œå¤šä¸ªå˜é‡å…±äº«åŒä¸€åº•å±‚æ•°æ®ï¼Œä¿®æ”¹ä¼šç›¸äº’å½±å“ã€‚
â€‹â€‹åˆ‡ç‰‡ (slice)â€‹â€‹ã€â€‹â€‹æ˜ å°„ (map)â€‹â€‹ã€â€‹â€‹é€šé“ (channel)â€‹â€‹ã€â€‹â€‹å‡½æ•° (function)â€‹â€‹ã€â€‹â€‹æ¥å£ (interface)â€‹â€‹&lt;/p&gt;

&lt;h2 id=&quot;æŒ‡é’ˆ&quot;&gt;æŒ‡é’ˆ&lt;/h2&gt;

&lt;p&gt;æŒ‡é’ˆçš„æœ¬è´¨æ˜¯å­˜å‚¨ä¸€ä¸ªâ€‹â€‹å†…å­˜åœ°å€â€‹â€‹ã€‚ç†è®ºä¸Šï¼Œä»»ä½•ç±»å‹çš„å˜é‡éƒ½æœ‰å…¶å†…å­˜åœ°å€ï¼Œå› æ­¤å‡ ä¹â€‹â€‹æ‰€æœ‰æ•°æ®ç±»å‹â€‹â€‹ï¼ˆåŒ…æ‹¬æ‰€æœ‰åŸºæœ¬ç±»å‹å’Œå¤åˆç±»å‹ï¼‰éƒ½å¯ä»¥æœ‰å¯¹åº”çš„æŒ‡é’ˆç±»å‹ã€‚&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;å‡½æ•°å‚æ•°ä¼ é€’é»˜è®¤æ˜¯â€‹â€‹å€¼ä¼ é€’â€‹â€‹ï¼Œè¿™æ„å‘³ç€ä¼ é€’çš„æ˜¯å˜é‡çš„å‰¯æœ¬ã€‚å½“å‚æ•°æ˜¯å¤§å‹ç»“æ„ä½“æˆ–æ•°ç»„æ—¶ï¼Œç›´æ¥ä¼ å€¼ä¼šå¯¼è‡´æ˜¾è‘—çš„å†…å­˜æ‹·è´å¼€é”€ï¼Œå½±å“æ€§èƒ½ã€‚ä½¿ç”¨æŒ‡é’ˆä¼ é€’å¯ä»¥æœ‰æ•ˆé¿å…è¿™ç§ä¸å¿…è¦çš„å¤åˆ¶ï¼Œå› ä¸ºä¼ é€’çš„åªæ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ï¼ˆåœ¨ 64 ä½ç³»ç»Ÿä¸Šé€šå¸¸æ˜¯ 8 å­—èŠ‚ï¼‰ï¼Œæ— è®ºåŸå¯¹è±¡æœ‰å¤šå¤§ï¼Œå¼€é”€å‡ ä¹ä¸å˜ã€‚&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;make&quot;&gt;make&lt;/h3&gt;
&lt;p&gt;makeå‡½æ•°æ˜¯ä¸“é—¨ç”¨äºåˆå§‹åŒ–â€‹â€‹åˆ‡ç‰‡ï¼ˆsliceï¼‰â€‹â€‹ã€â€‹â€‹æ˜ å°„ï¼ˆmapï¼‰â€‹â€‹ å’Œâ€‹â€‹é€šé“ï¼ˆchannelï¼‰â€‹â€‹ è¿™ä¸‰ç§å†…ç½®çš„å¼•ç”¨ç±»å‹çš„å†…ç½®å‡½æ•°ã€‚å®ƒä¼šå¯¹è¿™äº›ç±»å‹è¿›è¡Œå¿…è¦çš„å†…å­˜åˆ†é…å’Œåˆå§‹åŒ–ï¼Œä½¿å…¶ç«‹å³å¯ç”¨ã€‚&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;slice åˆ‡ç‰‡&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä½¿ç”¨&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸º&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;çš„&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åˆ‡ç‰‡ï¼ˆæŒ‡é’ˆåˆ‡ç‰‡ï¼‰&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;people&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([]*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;é•¿åº¦å’Œå®¹é‡å‡ä¸º&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;åˆå§‹åŒ–å: %v&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;people&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¾“å‡º&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;nil&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;&amp;gt;]&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä¸ºåˆ‡ç‰‡ä¸­çš„æ¯ä¸ªæŒ‡é’ˆå…ƒç´ åˆ†é…å…·ä½“çš„&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å®ä¾‹&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;people&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;people&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Sprintf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Person%d&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;  &lt;span class=&quot;m&quot;&gt;20&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ç°åœ¨å¯ä»¥å®‰å…¨åœ°è®¿é—®å’Œæ“ä½œ&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;_&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;range&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;people&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Name: %s, Age: %d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
  &lt;li&gt;mapé›†åˆæ˜ å°„&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä½¿ç”¨&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åˆå§‹åŒ–ä¸€ä¸ªé”®ä¸º&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å€¼ä¸º&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;çš„æ˜ å°„&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;scoreMap&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åˆå§‹å®¹é‡æç¤ºä¸º&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;5&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å‡†å¤‡ä¸€äº›æ•°æ®&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;scores&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;95&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;88&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;names&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Alice&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Bob&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Charlie&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å°†æŒ‡é’ˆæŒ‡å‘çš„åˆ†æ•°å­˜å…¥æ˜ å°„&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æ³¨æ„ï¼šä¸èƒ½ç›´æ¥ä½¿ç”¨&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å¦‚æœ&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scores&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æ˜¯åˆ‡ç‰‡ä¸”åç»­å¯èƒ½ä¿®æ”¹æˆ–æ‰©å®¹&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æ›´å®‰å…¨çš„åšæ³•æ˜¯åˆ›å»ºå˜é‡çš„åœ°å€ï¼Œæˆ–ç¡®ä¿åˆ‡ç‰‡ä¸å†ä¿®æ”¹&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;score&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åˆ›å»ºå‰¯æœ¬ï¼Œå–å…¶åœ°å€&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;scoreMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;names&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]]&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;score&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;éå†æ˜ å°„ï¼Œæ‰“å°é”®å’ŒæŒ‡é’ˆæŒ‡å‘çš„å€¼&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;range&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scoreMap&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Name: %s, Score: %d (æŒ‡é’ˆåœ°å€: %p)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;é€šè¿‡æŒ‡é’ˆä¿®æ”¹æ˜ å°„ä¸­çš„å€¼&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exists&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;scoreMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Alice&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;exists&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;99&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä¿®æ”¹&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Alice&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;çš„åˆ†æ•°&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ä¿®æ”¹å Alice çš„åˆ†æ•°:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;scoreMap&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Alice&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;chan é€šé“&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
    &lt;span class=&quot;s2&quot;&gt;&quot;time&quot;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä½¿ç”¨&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åˆ›å»ºä¸€ä¸ªèƒ½ç¼“å†²&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä¸ª&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æŒ‡é’ˆçš„é€šé“&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;msgChan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;make&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;go&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;func&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åœ¨&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;goroutine&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä¸­åˆ›å»ºä¸€äº›æ•´æ•°å¹¶å‘é€å…¶æŒ‡é’ˆåˆ°é€šé“&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åˆ›å»ºæ•´æ•°&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;å‘é€: %d (åœ°å€: %p)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;msgChan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;lt;-&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;num&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å‘é€æ•´æ•°çš„æŒ‡é’ˆåˆ°é€šé“&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Sleep&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;m&quot;&gt;100&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Millisecond&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;msgChan&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å‘é€å®Œæ¯•åå…³é—­é€šé“&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}()&lt;/span&gt;

    &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä»é€šé“æ¥æ”¶æ•´æ•°çš„æŒ‡é’ˆå¹¶æ‰“å°å…¶å€¼&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;æ¥æ”¶æ•°æ®:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;receivedPtr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;range&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;msgChan&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;æ¥æ”¶: %d (æ¥è‡ªåœ°å€: %p)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;receivedPtr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;receivedPtr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;new&quot;&gt;new&lt;/h3&gt;
&lt;p&gt;newå‡½æ•°å¸¸ç”¨æ¥å£°æ˜éå¼•ç”¨æ•°æ®ç±»å‹å¦‚åŸºæœ¬ç±»å‹ã€å¤åˆç±»å‹çš„å˜é‡ã€‚&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;// 1. åŸºæœ¬æ•°æ®ç±»å‹
var intPtr *int = new(int)           // *int, æŒ‡å‘ 0
var floatPtr *float64 = new(float64) // *float64, æŒ‡å‘ 0.0
var boolPtr *bool = new(bool)         // *bool, æŒ‡å‘ false
var strPtr *string = new(string)     // *string, æŒ‡å‘ &quot;&quot;
// 2. æ•°ç»„ (array)
var arrPtr *[3]int = new([3]int) // *[3]int, æŒ‡å‘ [3]int{0, 0, 0}
// 3. ç»“æ„ä½“ (struct)
type Person struct {
    Name string
    Age  int
}
var structPtr *Person = new(Person) // *Person, æŒ‡å‘ Person{&quot;&quot;, 0}
// 4. åˆ‡ç‰‡ (slice) - æ³¨æ„ï¼šnew åªä¸ºåˆ‡ç‰‡å¤´ç»“æ„åˆ†é…äº†å†…å­˜ï¼Œå…¶åº•å±‚æ•°ç»„ä¸º nil
var slicePtr *[]int = new([]int) // *[]int, æŒ‡å‘ä¸€ä¸ª nil åˆ‡ç‰‡
// 5. é›†åˆ (map) - æ³¨æ„ï¼šnew åªä¸º map æŒ‡é’ˆåˆ†é…äº†å†…å­˜ï¼Œå…¶åº•å±‚å“ˆå¸Œç»“æ„ä¸º nil
var mapPtr *map[string]int = new(map[string]int) // *map[string]int, æŒ‡å‘ä¸€ä¸ª nil map
// 6. é€šé“ (channel) - æ³¨æ„ï¼šnew åªä¸º channel æŒ‡é’ˆåˆ†é…äº†å†…å­˜ï¼Œå…¶åº•å±‚é€šé“ç»“æ„ä¸º nil
var chanPtr *chan int = new(chan int) // *chan int, æŒ‡å‘ä¸€ä¸ª nil channel
// 7. æŒ‡é’ˆçš„æŒ‡é’ˆ
var ptrToPtr **int = new(*int) // **int, æŒ‡å‘ä¸€ä¸ª *int ç±»å‹çš„æŒ‡é’ˆï¼Œè¯¥æŒ‡é’ˆæœ¬èº«ä¸º nil
// æ‰“å°åˆå§‹é›¶å€¼
fmt.Println(&quot;åŸºæœ¬ç±»å‹é›¶å€¼:&quot;, *intPtr, *floatPtr, *boolPtr, *strPtr)
fmt.Println(&quot;æ•°ç»„é›¶å€¼:&quot;, *arrPtr)
fmt.Println(&quot;ç»“æ„ä½“é›¶å€¼:&quot;, *structPtr)
fmt.Println(&quot;åˆ‡ç‰‡æŒ‡é’ˆçš„å€¼ (åº•å±‚æ•°ç»„ä¸ºnil):&quot;, *slicePtr) // è¾“å‡º []
fmt.Println(&quot;æ˜ å°„æŒ‡é’ˆçš„å€¼ (åº•å±‚æ˜ å°„ä¸ºnil):&quot;, *mapPtr)   // è¾“å‡º map[]
fmt.Println(&quot;é€šé“æŒ‡é’ˆçš„å€¼ (åº•å±‚é€šé“ä¸ºnil):&quot;, *chanPtr)   // è¾“å‡º &amp;lt;nil&amp;gt;
fmt.Println(&quot;æŒ‡é’ˆçš„æŒ‡é’ˆçš„å€¼ (æŒ‡å‘çš„æŒ‡é’ˆä¸ºnil):&quot;, *ptrToPtr) // è¾“å‡º &amp;lt;nil&amp;gt;

// é‡è¦è¯´æ˜ï¼šå¯¹äºå¼•ç”¨ç±»å‹ï¼ˆslice, map, channelï¼‰ï¼Œnew ä»…åˆ†é…äº†æŒ‡é’ˆæœ¬èº«çš„å†…å­˜ï¼Œ
// å¹¶æ²¡æœ‰åˆå§‹åŒ–å…¶åº•å±‚æ•°æ®ç»“æ„ã€‚ç›´æ¥ä½¿ç”¨ï¼ˆå¦‚èµ‹å€¼ã€å‘é€æ•°æ®ï¼‰ä¼šå¯¼è‡´ panicã€‚
// ä¾‹å¦‚ï¼š
// (*mapPtr)[&quot;key&quot;] = 1 // è¿™è¡Œä¼šå¼•å‘ panic: assignment to entry in nil map
// *slicePtr = append(*slicePtr, 1) // è¿™è¡Œå¯ä»¥æ‰§è¡Œï¼Œå› ä¸º append ä¼šå¤„ç† nil sliceï¼Œä½†é€šå¸¸ä¸è¿™æ ·ç”¨ã€‚

// æ­£ç¡®åˆå§‹åŒ–å¼•ç”¨ç±»å‹åº”ä½¿ç”¨ make å‡½æ•°ï¼š
*slicePtr = make([]int, 0, 10) // åˆå§‹åŒ–åˆ‡ç‰‡åº•å±‚æ•°ç»„
*mapPtr = make(map[string]int)  // åˆå§‹åŒ–æ˜ å°„
*chanPtr = make(chan int, 5)    // åˆå§‹åŒ–é€šé“
// åˆå§‹åŒ–åå³å¯å®‰å…¨ä½¿ç”¨
(*mapPtr)[&quot;key&quot;] = 100
*slicePtr = append(*slicePtr, 1, 2, 3)
go func() { *chanPtr &amp;lt;- 42 }()
fmt.Println(&quot;åˆå§‹åŒ–åçš„æ˜ å°„:&quot;, *mapPtr)
fmt.Println(&quot;åˆå§‹åŒ–åçš„åˆ‡ç‰‡:&quot;, *slicePtr)
fmt.Println(&quot;ä»é€šé“æ¥æ”¶å€¼:&quot;, &amp;lt;-*chanPtr)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h3 id=&quot;æŒ‡é’ˆåœ¨å‡½æ•°ä¸­çš„åº”ç”¨&quot;&gt;æŒ‡é’ˆåœ¨å‡½æ•°ä¸­çš„åº”ç”¨&lt;/h3&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;increment&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å‡½æ•°æ¥æ”¶ä¸€ä¸ªæŒ‡å‘æ•´æ•°çš„æŒ‡é’ˆï¼Œå¹¶å°†å…¶æŒ‡å‘çš„å€¼åŠ &lt;/span&gt;&lt;span class=&quot;m&quot;&gt;1&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;é€šè¿‡æŒ‡é’ˆä¿®æ”¹åŸå§‹å€¼&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;åŸå§‹å€¼:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¾“å‡º&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;åŸå§‹å€¼&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;10&lt;/span&gt;
    
    &lt;span class=&quot;n&quot;&gt;increment&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&amp;amp;&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;          &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä¼ é€’&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;count&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;çš„åœ°å€&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;è°ƒç”¨å:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¾“å‡º&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è°ƒç”¨å&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;11&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;æŒ‡é’ˆåœ¨æ–¹æ³•ä¸­çš„åº”ç”¨&quot;&gt;æŒ‡é’ˆåœ¨æ–¹æ³•ä¸­çš„åº”ç”¨&lt;/h3&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;fmt&quot;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;string&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;  &lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Birthday&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æ–¹æ³•ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶è€…&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;ï¼Œç”¨äºå¢åŠ å¹´é¾„&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Birthday&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;++&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ç›´æ¥ä¿®æ”¹æ¥æ”¶è€…&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;æ‰€æŒ‡å‘çš„&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å®ä¾‹çš„&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å­—æ®µ&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;%s è¿‡ç”Ÿæ—¥å•¦ï¼ç°åœ¨å¹´é¾„æ˜¯ %d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Alice&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;è°ƒç”¨å‰:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¾“å‡º&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è°ƒç”¨å‰&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;25&lt;/span&gt;
  
  &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Birthday&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;               &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è°ƒç”¨æ–¹æ³•ï¼Œ&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Go&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;ä¼šè‡ªåŠ¨å°†&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;çš„åœ°å€ä¼ é€’ç»™æŒ‡é’ˆæ¥æ”¶è€…&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;è°ƒç”¨å:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¾“å‡º&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è°ƒç”¨å&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;26&lt;/span&gt;
  
  &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;å³ä½¿ä½ æœ‰ä¸€ä¸ªæŒ‡é’ˆå˜é‡ï¼Œè°ƒç”¨æ–¹å¼ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼ˆ&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Go&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;çš„è¯­æ³•ç³–ï¼‰&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;ptr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Birthday&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;                  &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¾“å‡º&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Alice&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¿‡ç”Ÿæ—¥å•¦ï¼ç°åœ¨å¹´é¾„æ˜¯&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;27&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;fmt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;é€šè¿‡æŒ‡é’ˆè°ƒç”¨å:&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;person&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Age&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;//&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;è¾“å‡º&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;é€šè¿‡æŒ‡é’ˆè°ƒç”¨å&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;m&quot;&gt;27&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;å·å’Œç¬¦å·&quot;&gt;*å·å’Œ&amp;amp;ç¬¦å·&lt;/h3&gt;
&lt;p&gt;å£°æ˜å˜é‡ä¸ºæŒ‡é’ˆå˜é‡&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;
//æŒ‡é’ˆ
intP1 := 100
var intPointer *int
intPointer = &amp;amp;intP1
intPointer2 := *intPointer
fmt.Println(intPointer, *intPointer, intPointer2)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;typeå…³é”®å­—&quot;&gt;typeå…³é”®å­—&lt;/h2&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;//è‡ªå®šä¹‰ç±»å‹ï¼ˆåœ¨åŸºæœ¬ç±»å‹åŸºç¡€ä¸Šï¼‰ï¼Œä½¿ç”¨å¤§å°é©¼å³°ï¼Œå¤§é©¼å³°ä»£è¡¨å¯¼å‡ºï¼Œå°é©¼å³°åªåœ¨åŒ…å†…ã€‚
type MyInt int
type myInt int
//ç»“æ„ä½“
type ShoppingCart struct{

}
//æ¥å£
type Formatter interface{

}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;h2 id=&quot;ç±»å‹æ–­è¨€&quot;&gt;ç±»å‹æ–­è¨€&lt;/h2&gt;</content><author><name>Zhao Q.H.</name></author><category term="Go" /><summary type="html">æ•°æ®ç±»å‹ Go è¯­è¨€ä¸­çš„æ•°æ®ç±»å‹å¯ä»¥ä»ä¸åŒç»´åº¦è¿›è¡Œåˆ†ç±»ã€‚æŒ‰ç»„æˆç»“æ„â€‹â€‹ï¼Œåˆ†ä¸ºåŸºæœ¬ç±»å‹å’Œå¤åˆç±»å‹ã€‚â€‹â€‹æŒ‰èµ‹å€¼ä¼ é€’è¡Œä¸ºâ€‹â€‹åˆ†ä¸ºå€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹ã€‚ åŸºç¡€ç±»å‹ æ„æˆç¨‹åºçš„åŸºç¡€ï¼Œä¸å¯å†æ‹†åˆ†ï¼Œå†…å­˜å ç”¨å›ºå®š å¸ƒå°” var b1 bool b1 = true b2 := false å­—ç¬¦ä¸² string å’Œ byte[]ï¼Œstringå¯ä»¥ç›´æ¥è½¬æ¢æˆbyteå­—èŠ‚åˆ‡ç‰‡ var ( str1 string = &quot;hello string&quot; ) str2 := &quot;hello str2&quot; fmt.Println(str1, str2) æ•´å‹ 11ç§å†…ç½®æ•´æ•°ç±»å‹ï¼šint8ã€uint8ã€int16ã€uint16ã€int32ã€uint32ã€int64ã€uint64ã€intã€uintå’Œuintptr var a int = 10 var i1, i2 int = 10, 20 i3 := 30 //é»˜è®¤ç±»å‹æ˜¯int fmt.Println(i1, i2, i3) fmt.Printf(&quot;i1 type is %T\n &quot;, i1) fmt.Printf(&quot;i3 type is %T\n\n &quot;, i3) æµ®ç‚¹å‹ ä¸¤ç§å†…ç½®æµ®ç‚¹æ•°ç±»å‹ï¼šfloat32å’Œfloat64ã€‚ var f1 float32 = 3.14 f2 := 3.14 //é»˜è®¤æ•°æ®ç±»å‹æ˜¯float64 fmt.Println(f1, f2) fmt.Printf(&quot;f2 type is %T\n &quot;, f2) å¤æ•° var cmp1 complex64 = 1 + 2i cmp2 := 2 + 4i //é»˜è®¤å€¼æ˜¯complex128 fmt.Println(cmp1, cmp2) fmt.Printf(&quot;cmp2 type is %T\n&quot;, cmp2) é›¶å‹</summary></entry></feed>